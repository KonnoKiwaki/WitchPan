import{ad as Y,e as F,j as e,a9 as A,G as T,ae as I,H as Z,g as X,af as J,ag as Q,ah as ee,_ as te,v as ne,h as K,a0 as oe,o as E,c as N,B as W,C as $,a as q,k as j,w as G,l as ae,F as M,r as ie,ai as U,aj as le}from"./index-cd067b4e.js";const se={...Y.props,size:{type:String,default:"default"},dataSource:{type:[Object],default:()=>[]},columns:{type:[Array],default:()=>[],required:!0},request:{type:Function,default:null},rowKey:{type:[String,Function],default:void 0},pagination:{type:[Object,Boolean],default:()=>{}},extHeight:{type:Number,default:0},tableHeight:{type:Number,default:0},loading:{type:Boolean,default:!1},selection:{type:Boolean,default:!0}};function ce(i){const a=F(e(i).loading);A(()=>e(i).loading,g=>{a.value=g});const c=T(()=>e(a));function l(g){a.value=g}return{getLoading:c,setLoading:l}}const re={table:{apiSetting:{pageField:"page",sizeField:"pageSize",listField:"records",totalField:"pages",itemCountField:"total"},defaultPageSize:10,pageSizes:[5,10,20,30,40]},upload:{apiSetting:{infoField:"data",imgField:"photo"},maxSize:2,fileType:["image/png","image/jpg","image/jpeg","image/gif","image/svg+xml"]}},{table:ue}=re,{apiSetting:de,defaultPageSize:fe,pageSizes:ge}=ue,pe=fe,C=de,he=ge;function we(i){const a=F({}),c=F(!0),l=T(()=>{const{pagination:s}=e(i);if(!e(c)||I(s)&&!s)return!1;const{totalField:d,itemCountField:b}=C;return{pageSize:pe,pageSizes:he,showSizePicker:!0,showQuickJumper:!0,...I(s)?{}:s,...e(a),pageCount:e(a)[d],itemCount:e(a)[b]||0}});function g(s){const d=e(l);a.value={...I(d)?{}:d,...s}}function f(){return e(l)}function n(){return e(c)}async function v(s){c.value=s}return{getPagination:f,getPaginationInfo:l,setShowPagination:v,getShowPagination:n,setPagination:g}}function me(i,{getPaginationInfo:a,setPagination:c,setLoading:l,tableData:g},f){const n=F([]);Z(()=>{g.value=e(n)}),A(()=>e(i).dataSource,()=>{const{dataSource:t}=e(i);t&&(n.value=t)},{immediate:!0});const v=T(()=>{const{rowKey:t}=e(i);return t||(()=>"key")}),s=T(()=>{const t=e(n);return!t||t.length===0?e(n):e(n)});async function d(t){try{l(!0);const{request:r,pagination:m}=e(i);if(!r)return;const p=C.pageField,y=C.sizeField,H=C.totalField,O=C.listField,V=C.itemCountField;let _={};const{page:o=1,pageSize:S=10}=e(a);I(m)&&!m||I(a)?_={}:(_[p]=t&&t[p]||o,_[y]=S);let h={..._};const w=await r(h),R=w[H]||0,u=w[p],x=w[V];R&&o>R&&(c({[p]:R}),d(t));let D=w[O]?w[O]:[];n.value=D,c({[p]:u,[H]:R,[V]:x}),t&&t[p]&&c({[p]:t[p]||1}),f("fetch-success",{items:e(D),resultTotal:R,totalData:x})}catch(r){console.error(r),f("fetch-error",r),n.value=[]}finally{l(!1)}}X(()=>{setTimeout(()=>{d()},16)});function b(t){n.value=t}function z(){return s.value}async function B(t){await d(t)}function P(t,r){n.value.forEach(m=>{m[t]=r})}function k(t){n.value.unshift(t)}function L(t,r){n.value.splice(r,1),n.value.splice(r,0,t)}return{fetch:d,getRowKey:v,getDataSourceRef:s,getDataSource:z,setTableData:b,reload:B,setRowFieldValue:P,unshiftRow:k,setRowValue:L}}function Se(i){return!i||!i.getBoundingClientRect?0:i.getBoundingClientRect()}function ve(i){const a=document.documentElement,c=a.scrollLeft,l=a.scrollTop,g=a.clientLeft,f=a.clientTop,n=window.pageXOffset,v=window.pageYOffset,s=Se(i),{left:d,top:b,width:z,height:B}=s,P=(n||c)-(g||0),k=(v||l)-(f||0),L=d+n,t=b+v,r=L-P,m=t-k,p=window.document.documentElement.clientWidth,y=window.document.documentElement.clientHeight;return{left:r,top:m,right:y-z-r,bottom:y-B-m,rightIncludeBody:p-r,bottomIncludeBody:y-m}}function be(i,a=150,c){let l=()=>{i()};l=ee(l,a);const f=()=>{c&&c.immediate&&l(),window.addEventListener("resize",l)},n=()=>{window.removeEventListener("resize",l)};return J(()=>{f()}),Q(()=>{n()}),[f,n]}const ye={class:"table"},_e={class:"file-table"},Fe={class:"empty"},Re={name:"BasicTable"},Ee=Object.assign(Re,{props:{...se},emits:["fetch-success","fetch-error","select-change"],setup(i,{expose:a,emit:c}){const l=i,g=F(150),f=F([]),n=F(),v=F(),s=T(()=>({...l,...e(v)})),{getLoading:d,setLoading:b}=ce(s),{getPaginationInfo:z,setPagination:B}=we(s),{getDataSourceRef:P,getRowKey:k,reload:L,setRowFieldValue:t,unshiftRow:r,setRowValue:m}=me(s,{getPaginationInfo:z,setPagination:B,tableData:f,setLoading:b},c),p=T(()=>{const o=e(P),S=o.length?`${e(g)}px`:"auto";return{...e(s),data:o,rowKey:e(k),maxHeight:S}});let y=[];function H(o){let S=n.value.getSelectionRows().includes(o)&&n.value.getSelectionRows().length==1;n.value.clearSelection(),n.value.toggleRowSelection(o,!S)}function O(o){y=o.map(h=>h.id),c("select-change",o)}function V({row:o,_:S}){let h="";return y.forEach(w=>{if(w===o.id)return h="is-selected"}),h}async function _(){const o=e(n);if(!o)return;const h=(o==null?void 0:o.$el).querySelector(".el-table__header"),{bottomIncludeBody:w}=ve(h);g.value=w}return be(_,280),A(()=>f.value.length,()=>{_()}),X(()=>{ne(()=>{_()})}),a({reload:L,tableElRef:n,setRowFieldValue:t,unshiftRow:r,setRowValue:m,setLoading:b}),(o,S)=>{const h=K("el-table-column"),w=K("el-table"),R=oe("loading");return E(),N("div",ye,[W(q("div",_e,[W((E(),j(w,le({ref_key:"tableElRef",ref:n},p.value,{onRowClick:H,onSelectionChange:O,"row-class-name":V}),{default:G(()=>[o.selection?(E(),j(h,{key:0,type:"selection",width:"48px",align:"center","class-name":"checkbox"})):ae("",!0),(E(!0),N(M,null,ie(o.columns,(u,x)=>(E(),N(M,null,[u.scopedSlots?(E(),j(h,{key:x,prop:u.prop,label:u.label,align:u.align||"left",width:u.width,"min-width":u.minWidth,"show-overflow-tooltip":u.ellipsis},{default:G(D=>[U(o.$slots,u.scopedSlots,{index:D.$index,row:D.row},void 0,!0)]),_:2},1032,["prop","label","align","width","min-width","show-overflow-tooltip"])):(E(),j(h,{key:x,prop:u.prop,label:u.label,align:u.align||"left",width:u.width,"min-width":u.minWidth,"show-overflow-tooltip":u.ellipsis},null,8,["prop","label","align","width","min-width","show-overflow-tooltip"]))],64))),256))]),_:3},16)),[[R,e(d)]])],512),[[$,e(d)||f.value.length>0]]),W(q("div",Fe,[U(o.$slots,"empty",{},void 0,!0)],512),[[$,!e(d)&&f.value.length===0]])])}}}),Te=te(Ee,[["__scopeId","data-v-0d3f9d71"]]);export{Te as B};
