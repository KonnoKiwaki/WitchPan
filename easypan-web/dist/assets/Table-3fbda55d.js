import{bM as X,r as F,i as e,bB as K,A as T,B as Y,f as U,bN as Z,bO as Q,bP as ee,q as te,g as W,J as ne,o as E,c as N,x as A,y as q,a as $,j,w as G,k as oe,F as M,v as ae,b3 as J,aK as ie}from"./index-ea894644.js";import{j as I}from"./setting-8d83341a.js";import{_ as le}from"./_plugin-vue_export-helper-c27b6911.js";const se={...X.props,size:{type:String,default:"default"},dataSource:{type:[Object],default:()=>[]},columns:{type:[Array],default:()=>[],required:!0},request:{type:Function,default:null},rowKey:{type:[String,Function],default:void 0},pagination:{type:[Object,Boolean],default:()=>{}},extHeight:{type:Number,default:0},tableHeight:{type:Number,default:0},loading:{type:Boolean,default:!1},selection:{type:Boolean,default:!0}};function ce(i){const a=F(e(i).loading);K(()=>e(i).loading,g=>{a.value=g});const c=T(()=>e(a));function l(g){a.value=g}return{getLoading:c,setLoading:l}}const re={table:{apiSetting:{pageField:"page",sizeField:"pageSize",listField:"records",totalField:"pages",itemCountField:"total"},defaultPageSize:10,pageSizes:[5,10,20,30,40]},upload:{apiSetting:{infoField:"data",imgField:"photo"},maxSize:2,fileType:["image/png","image/jpg","image/jpeg","image/gif","image/svg+xml"]}},{table:ue}=re,{apiSetting:de,defaultPageSize:fe,pageSizes:ge}=ue,pe=fe,B=de,he=ge;function we(i){const a=F({}),c=F(!0),l=T(()=>{const{pagination:s}=e(i);if(!e(c)||I(s)&&!s)return!1;const{totalField:d,itemCountField:v}=B;return{pageSize:pe,pageSizes:he,showSizePicker:!0,showQuickJumper:!0,...I(s)?{}:s,...e(a),pageCount:e(a)[d],itemCount:e(a)[v]||0}});function g(s){const d=e(l);a.value={...I(d)?{}:d,...s}}function f(){return e(l)}function n(){return e(c)}async function S(s){c.value=s}return{getPagination:f,getPaginationInfo:l,setShowPagination:S,getShowPagination:n,setPagination:g}}function me(i,{getPaginationInfo:a,setPagination:c,setLoading:l,tableData:g},f){const n=F([]);Y(()=>{g.value=e(n)}),K(()=>e(i).dataSource,()=>{const{dataSource:t}=e(i);t&&(n.value=t)},{immediate:!0});const S=T(()=>{const{rowKey:t}=e(i);return t||(()=>"key")}),s=T(()=>{const t=e(n);return!t||t.length===0?e(n):e(n)});async function d(t){try{l(!0);const{request:r,pagination:m}=e(i);if(!r)return;const p=B.pageField,y=B.sizeField,O=B.totalField,H=B.listField,V=B.itemCountField;let _={};const{page:o=1,pageSize:b=10}=e(a);I(m)&&!m||I(a)?_={}:(_[p]=t&&t[p]||o,_[y]=b);let h={..._};const w=await r(h),R=w[O]||0,u=w[p],x=w[V];R&&o>R&&(c({[p]:R}),d(t));let D=w[H]?w[H]:[];n.value=D,c({[p]:u,[O]:R,[V]:x}),t&&t[p]&&c({[p]:t[p]||1}),f("fetch-success",{items:e(D),resultTotal:R,totalData:x})}catch(r){console.error(r),f("fetch-error",r),n.value=[]}finally{l(!1)}}U(()=>{setTimeout(()=>{d()},16)});function v(t){n.value=t}function z(){return s.value}async function C(t){await d(t)}function P(t,r){n.value.forEach(m=>{m[t]=r})}function k(t){n.value.unshift(t)}function L(t,r){n.value.splice(r,1),n.value.splice(r,0,t)}return{fetch:d,getRowKey:S,getDataSourceRef:s,getDataSource:z,setTableData:v,reload:C,setRowFieldValue:P,unshiftRow:k,setRowValue:L}}function be(i){return!i||!i.getBoundingClientRect?0:i.getBoundingClientRect()}function Se(i){const a=document.documentElement,c=a.scrollLeft,l=a.scrollTop,g=a.clientLeft,f=a.clientTop,n=window.pageXOffset,S=window.pageYOffset,s=be(i),{left:d,top:v,width:z,height:C}=s,P=(n||c)-(g||0),k=(S||l)-(f||0),L=d+n,t=v+S,r=L-P,m=t-k,p=window.document.documentElement.clientWidth,y=window.document.documentElement.clientHeight;return{left:r,top:m,right:y-z-r,bottom:y-C-m,rightIncludeBody:p-r,bottomIncludeBody:y-m}}function ve(i,a=150,c){let l=()=>{i()};l=Z(l,a);const f=()=>{c&&c.immediate&&l(),window.addEventListener("resize",l)},n=()=>{window.removeEventListener("resize",l)};return Q(()=>{f()}),ee(()=>{n()}),[f,n]}const ye={class:"table"},_e={class:"file-table"},Fe={class:"empty"},Re={name:"BasicTable"},Ee=Object.assign(Re,{props:{...se},emits:["fetch-success","fetch-error","select-change"],setup(i,{expose:a,emit:c}){const l=i,g=F(150),f=F([]),n=F(),S=F(),s=T(()=>({...l,...e(S)})),{getLoading:d,setLoading:v}=ce(s),{getPaginationInfo:z,setPagination:C}=we(s),{getDataSourceRef:P,getRowKey:k,reload:L,setRowFieldValue:t,unshiftRow:r,setRowValue:m}=me(s,{getPaginationInfo:z,setPagination:C,tableData:f,setLoading:v},c),p=T(()=>{const o=e(P),b=o.length?`${e(g)}px`:"auto";return{...e(s),data:o,rowKey:e(k),maxHeight:b}});let y=[];function O(o){let b=n.value.getSelectionRows().includes(o)&&n.value.getSelectionRows().length==1;n.value.clearSelection(),n.value.toggleRowSelection(o,!b)}function H(o){y=o.map(h=>h.id),c("select-change",o)}function V({row:o,_:b}){let h="";return y.forEach(w=>{if(w===o.id)return h="is-selected"}),h}async function _(){const o=e(n);if(!o)return;const h=(o==null?void 0:o.$el).querySelector(".el-table__header"),{bottomIncludeBody:w}=Se(h);g.value=w}return ve(_,280),K(()=>f.value.length,()=>{_()}),U(()=>{te(()=>{_()})}),a({reload:L,tableElRef:n,setRowFieldValue:t,unshiftRow:r,setRowValue:m,setLoading:v}),(o,b)=>{const h=W("el-table-column"),w=W("el-table"),R=ne("loading");return E(),N("div",ye,[A($("div",_e,[A((E(),j(w,ie({ref_key:"tableElRef",ref:n},p.value,{onRowClick:O,onSelectionChange:H,"row-class-name":V}),{default:G(()=>[o.selection?(E(),j(h,{key:0,type:"selection",width:"48px",align:"center","class-name":"checkbox"})):oe("",!0),(E(!0),N(M,null,ae(o.columns,(u,x)=>(E(),N(M,null,[u.scopedSlots?(E(),j(h,{key:x,prop:u.prop,label:u.label,align:u.align||"left",width:u.width,"min-width":u.minWidth,"show-overflow-tooltip":u.ellipsis},{default:G(D=>[J(o.$slots,u.scopedSlots,{index:D.$index,row:D.row},void 0,!0)]),_:2},1032,["prop","label","align","width","min-width","show-overflow-tooltip"])):(E(),j(h,{key:x,prop:u.prop,label:u.label,align:u.align||"left",width:u.width,"min-width":u.minWidth,"show-overflow-tooltip":u.ellipsis},null,8,["prop","label","align","width","min-width","show-overflow-tooltip"]))],64))),256))]),_:3},16)),[[R,e(d)]])],512),[[q,e(d)||f.value.length>0]]),A($("div",Fe,[J(o.$slots,"empty",{},void 0,!0)],512),[[q,!e(d)&&f.value.length===0]])])}}}),Ce=le(Ee,[["__scopeId","data-v-0d3f9d71"]]);export{Ce as B};
