import{d as oe,o as a,c as u,a as e,_ as ne,e as r,f as j,E as te,W as be,h as k,i as l,w as o,X as ce,F as le,r as he,N as I,t as U,q as me,v as se,Y as xe,Z as O,$ as ke,a0 as Ce,k as W,B as M,m as P,A as $e,j as $,C as H,l as Y,y as ve,z as ye,G as Fe,p as _e,a1 as fe,I as Se,a2 as we,a3 as Re,a4 as Ve,a5 as Te,a6 as ze,a7 as Ee,a8 as Ae}from"./index-cd067b4e.js";import{B as Pe}from"./Table-58a1515f.js";import{_ as pe}from"./ShareFile.vue_vue_type_style_index_0_scoped_ae51d12c_lang-93d12c37.js";import{D as Ie}from"./DeleteFile-ca5d066b.js";import{s as Me}from"./share-d89e6911.js";const Oe={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},Ue=e("path",{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448s448-200.6 448-448S759.4 64 512 64zm193.5 301.7l-210.6 292a31.8 31.8 0 0 1-51.7 0L318.5 484.9c-3.8-5.3 0-12.7 6.5-12.7h46.9c10.2 0 19.9 4.9 25.9 13.3l71.2 98.8l157.2-218c6-8.3 15.6-13.3 25.9-13.3H699c6.5 0 10.3 7.4 6.5 12.7z",fill:"currentColor"},null,-1),De=[Ue],Ne=oe({name:"CheckCircleFilled",render:function(S,F){return a(),u("svg",Oe,De)}}),Be={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},He=e("path",{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448s448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372s372 166.6 372 372s-166.6 372-372 372z",fill:"currentColor"},null,-1),Le=e("path",{d:"M464 688a48 48 0 1 0 96 0a48 48 0 1 0-96 0zm24-112h48c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8z",fill:"currentColor"},null,-1),je=[He,Le],Ke=oe({name:"ExclamationCircleOutlined",render:function(S,F){return a(),u("svg",Be,je)}}),qe={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},We=e("path",{d:"M484 443.1V528h-84.5c-4.1 0-7.5 3.1-7.5 7v42c0 3.8 3.4 7 7.5 7H484v84.9c0 3.9 3.2 7.1 7 7.1h42c3.9 0 7-3.2 7-7.1V584h84.5c4.1 0 7.5-3.2 7.5-7v-42c0-3.9-3.4-7-7.5-7H540v-84.9c0-3.9-3.1-7.1-7-7.1h-42c-3.8 0-7 3.2-7 7.1zm396-144.7H521L403.7 186.2a8.15 8.15 0 0 0-5.5-2.2H144c-17.7 0-32 14.3-32 32v592c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V330.4c0-17.7-14.3-32-32-32zM840 768H184V256h188.5l119.6 114.4H840V768z",fill:"currentColor"},null,-1),Ye=[We],Ze=oe({name:"FolderAddOutlined",render:function(S,F){return a(),u("svg",qe,Ye)}}),Ge={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},Xe=e("path",{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 0 0-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z",fill:"currentColor"},null,-1),Je=[Xe],Qe=oe({name:"UploadOutlined",render:function(S,F){return a(),u("svg",Ge,Je)}}),et={all:{accept:"*"},video:{accept:".mp4, .avi, .rmvb, .mkv, .mov .flv"},music:{accept:".mp3, .wav, .wma, .mp2, .flac, .midi, .ra, .ape, .aac, .cda"},image:{accept:".jpeg, .jpg, .png, .gif, .bmp, .dds, .psd, .pdt, .webp, .xmp, .svg, .tiff"},doc:{accept:".pdf, .doc, .docx, .xlsx, .excel, .txt"},other:{accept:"*"}},tt={class:"selector-body"},lt={class:"navigation-panel"},st={class:"table"},ot={key:0,class:"folder-list"},at=["onClick"],it={class:"folder-name"},nt={key:1,class:"empty"},ct={class:"text"},dt={name:"FolderSelect",components:{Navigation:ce}},rt=Object.assign(dt,{emits:["move-success"],setup(m,{expose:S,emit:F}){const T=r(),b=r([]),i=r({});let s=[],R=[],h={filePid:"0"};const C=j({show:!1,title:"移动到",showCancel:!0,buttons:[{type:"primary",text:"移动到此",round:!0,click:f=>{D()}}]}),V=async()=>{try{const f=await xe(h);if(!f)return;b.value=f}catch{C.show=!1}},n=f=>{const{curFolder:y}=f;i.value=y,h.filePid=y.id,V()},_=f=>{T.value.openFolder(f)},D=async()=>{if(R.includes(h.filePid))return te.info("文件正在当前目录，无需移动");await be({filePid:h.filePid,ids:s.join(",")}),F("move-success"),C.show=!1};function z(f){let y=f;O(f)||(y=[f]),s=y.map(w=>w.id),h={filePid:"0"},R=[...new Set(y.map(w=>w.filePid))],C.show=!0,se(()=>{T.value.init()})}return S({show:z}),(f,y)=>{const w=k("el-scrollbar");return a(),u("div",null,[l(me,{show:C.show,title:C.title,buttons:C.buttons,"show-cancel":!0,width:"720px",onClose:y[0]||(y[0]=v=>C.show=!1),padding:0,paddinglr:0},{default:o(()=>[e("div",tt,[e("div",lt,[l(ce,{ref_key:"navigationRef",ref:T,"watch-path":!1,onNavChange:n},null,512)]),e("div",st,[l(w,{"view-style":"height:100%"},{default:o(()=>[b.value.length>0?(a(),u("div",ot,[(a(!0),u(le,null,he(b.value,v=>(a(),u("div",{class:"folder-item",onClick:p=>_(v)},[l(I,{"icon-name":"folder_2",width:40}),e("span",it,U(v.filename),1)],8,at))),256))])):(a(),u("div",nt,[l(I,{"icon-name":"folder_empty",width:90}),e("p",ct,"移动到"+U(i.value.filename)+"文件夹",1)]))]),_:1})])])]),_:1},8,["show","title","buttons"])])}}}),ut=ne(rt,[["__scopeId","data-v-8facdc29"]]),Z=m=>(ve("data-v-ae51d12c"),m=m(),ye(),m),_t={class:"share-container"},ft={style:{width:"400px"}},pt=Z(()=>e("br",null,null,-1)),ht={class:"share-success"},mt={class:"msg"},vt=Z(()=>e("span",{class:"text"},"成功创建分享链接，访问者无需提取码可直接查看分享文件",-1)),yt={class:"link",style:{display:"flex"}},wt=Z(()=>e("span",{class:"label; out"},"链接码",-1)),gt=Z(()=>e("div",{class:"mask"},null,-1)),bt={class:"link-code"},xt=Z(()=>e("span",{class:"label"},"提取码",-1)),kt={class:"inline"},Ct={class:"tip"},$t={name:"ShareFile"},Ft=Object.assign($t,{setup(m,{expose:S}){const F=[{label:"0",value:"1天"},{label:"1",value:"7天"},{label:"2",value:"30天"},{label:"3",value:"永久有效"}],{toClipboard:T}=ke(),b=r(0),i=r({}),s=r(!1),R=r(),h=j({type:"info",msg:"仅支持数字及英文字母"}),C=r(document.location.origin+"/shareCheck/"),V=j({}),n=j({validType:"1",codType:"0",code:"",withCode:!1}),_=j({show:!1,title:"分享文件: ",showCancel:!0,buttons:[{type:"primary",text:"创建链接",isShow:!0,click:v=>{y()}},{type:"success",text:"复制链接及提取码",isShow:!1,click:v=>{w()}}]});function D(v){O(v)&&(b.value=0,_.show=!0,se(()=>{R.value.resetFields(),b.value=0,_.buttons[0].isShow=!0,_.buttons[1].isShow=!1}),v.length>1?_.title="分享文件: 整合包分享":_.title="分享文件: "+v[0].filename,i.value=v[0])}function z(){h.type="info",h.value="仅支持数字及英文字母",n.code=""}function f(){/^[A-Za-z\d]{4}$/.test(n.code)?(h.type="info",h.value="仅支持数字及英文字母"):(h.type="error",h.value="仅可输入4位字母和数字")}const y=async()=>{s.value=!0;const v={fileId:i.value.id,validType:n.validType,code:n.code};try{const p=await Me(v);if(!p)return;Object.assign(V,p),b.value=1,_.buttons[0].isShow=!1,_.buttons[1].isShow=!0,s.value=!1}catch{}},w=async()=>{await T(`链接: ${C.value}${V.id} 提取码: ${V.code}`),te.success("复制成功")};return S({show:D}),(v,p)=>{const E=k("el-radio"),G=k("el-radio-group"),X=k("el-form-item"),K=k("el-input"),J=k("el-checkbox"),L=k("el-icon"),ae=k("el-tooltip"),Q=k("el-form"),ie=Ce("loading");return a(),W(me,{show:_.show,title:_.title,buttons:_.buttons,"show-cancel":!0,width:"600px",onClose:p[4]||(p[4]=g=>_.show=!1)},{default:o(()=>[M((a(),u("div",_t,[M(l(Q,{model:n,ref_key:"shareFormRef",ref:R},{default:o(()=>[l(X,{label:"有效期"},{default:o(()=>[l(G,{modelValue:n.validType,"onUpdate:modelValue":p[0]||(p[0]=g=>n.validType=g)},{default:o(()=>[(a(),u(le,null,he(F,g=>l(E,{label:g.label},{default:o(()=>[P(U(g.value),1)]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"])]),_:1}),l(X,{label:"提取码"},{default:o(()=>[e("div",ft,[l(G,{modelValue:n.codType,"onUpdate:modelValue":p[2]||(p[2]=g=>n.codType=g),onChange:z},{default:o(()=>[l(E,{label:"0"},{default:o(()=>[P("系统随机生成验证码")]),_:1}),l(E,{label:"1",style:{"margin-top":"10px"}},{default:o(()=>[l(K,{modelValue:n.code,"onUpdate:modelValue":p[1]||(p[1]=g=>n.code=g),placeholder:"请输入4位提取码",disabled:n.codType!=="1",style:{width:"160px"},onChange:f},null,8,["modelValue","disabled"]),e("span",{class:$e(["tips",h.type])},U(h.msg),3)]),_:1})]),_:1},8,["modelValue"]),e("div",null,[l(J,{modelValue:n.withCode,"onUpdate:modelValue":p[3]||(p[3]=g=>n.withCode=g),label:"分享链接自动填充提取码",size:"large"},null,8,["modelValue"]),l(ae,{effect:"dark",content:"",placement:"right"},{content:o(()=>[P(" 开启后分享链接会带上提取码，"),pt,P(" 用户点击链接可自动填充提取码 ")]),default:o(()=>[l(L,{style:{"margin-left":"6px"}},{default:o(()=>[l($(Ke))]),_:1})]),_:1})])])]),_:1})]),_:1},8,["model"]),[[H,b.value==0]]),M(e("div",ht,[e("div",mt,[l(L,{size:"16"},{default:o(()=>[l($(Ne))]),_:1}),vt]),e("div",yt,[wt,l(K,{value:C.value+V.id,readonly:"",style:{flex:"1","margin-left":"8px"}},null,8,["value"]),gt]),e("div",bt,[xt,e("div",kt,[l(K,{value:V.code,readonly:""},null,8,["value"])])]),e("div",Ct,[P(" 链接"),e("span",null,U(F[n.validType].value),1),n.validType!=3?(a(),u(le,{key:0},[P("后失效")],64)):Y("",!0)])],512),[[H,b.value==1]])])),[[ie,s.value]])]),_:1},8,["show","title","buttons"])}}}),St=ne(Ft,[["__scopeId","data-v-ae51d12c"]]),Rt=({shareFile:m,downloadFile:S,deleteFile:F,renameFile:T,copyFile:b,moveFile:i})=>[{title:"分享",label:"share",icon:"share",onClick:s=>{m(s)}},{title:"下载",label:"download",icon:"download",isShow:s=>!O(s)||O(s)&&s.filter(R=>R.folderType===1).length===0,onClick:s=>{S(s)}},{title:"删除",label:"delete",icon:"delete",onClick:s=>{F(s)}},{title:"重命名",label:"rename",icon:"rename",onClick:s=>{T(s)},isShow:s=>!O(s)||O(s)&&s.length==1},{title:"复制",label:"copy",icon:"copy",onClick:s=>{b(s)}},{title:"移动",label:"move",icon:"move",onClick:s=>{i(s)}}];const de=m=>(ve("data-v-a46e94d8"),m=m(),ye(),m),Vt={class:"main"},Tt={class:"main-header"},zt={class:"toolbar"},Et={class:"toolbar-action"},At={class:"toolbar-group"},Pt={class:"toolbar-group-item"},It={class:"action-main"},Mt={class:"toolbar-group-item"},Ot={class:"action-list"},Ut={class:"toolbar-group-item"},Dt={class:"toolbar-customize"},Nt={class:"search"},Bt={class:"main-body"},Ht={class:"nav"},Lt={class:"nav-list"},jt={class:"nav-left"},Kt={class:"file-list overflow-visible"},qt={class:"file-item"},Wt={key:2,class:"file-name"},Yt=["onClick"],Zt={key:0,class:"transfer-status"},Gt={key:1,class:"transfer-status transfer-fail"},Xt={class:"edit-action is-confirm"},Jt=["onClick"],Qt={class:"edit-action is-cancel"},el=["onClick"],tl={class:"file-size"},ll={key:0},sl={key:1},ol={class:"table-empty"},al={class:"main-empty"},il={class:"u-empty"},nl={class:"empty-image"},cl=de(()=>e("div",{class:"empty-description"},[e("span",{class:"text"},"当前列表为空，上传你的第一个文件吧")],-1)),dl={class:"empty-bottom"},rl={class:"empty-action"},ul={class:"action-item"},_l={class:"action-item-image"},fl=de(()=>e("div",{class:"action-item-text"},"上传文件",-1)),pl={class:"action-item-image"},hl=de(()=>e("div",{class:"action-item-text"},"新建文件夹",-1)),ml={name:"Main",components:{Preview:we}},vl=Object.assign(ml,{emits:["addFile"],setup(m,{expose:S,emit:F}){const T=[{label:"文件名",prop:"filename",scopedSlots:"filename",ellipsis:!0,minWidth:"40%"},{label:"修改时间",prop:"updateTime",minWidth:"25%",scopedSlots:"RowAction"},{label:"大小",prop:"fileSize",scopedSlots:"fileSize",minWidth:"23%"}],{fileUrlMap:b}=Ae,i=r(),s=r(),R=r(),h=r(),C=r(),V=r(),n=r(),_=r(!1),D=r(),z=r([]),f=r({id:"0"}),y=r(T),w=j({page:1,pageSize:20,filePid:"0",category:"all"}),v=Rt({deleteFile:t=>{C.value.show(t)},renameFile:t=>{ie(t)},moveFile:t=>{V.value.show(t)},downloadFile:async t=>{ge(t)},shareFile:t=>{n.value.show(t)}}),p=Fe(()=>{const t=et[w.category];return t?t.accept:"*"});function E(){var t;(t=i.value)==null||t.reload()}function G(t){const{category:c,curFolder:x}=t;w.category=c,w.filePid=x.id,f.value=x,E()}const X=async t=>{const c={...t,...w};c.category!=="all"&&delete c.filePid;try{return Re(c)}catch{return[]}},K=t=>{t.length>0?y.value[0].label=`已选中${t.length}个文件/文件夹`:y.value[0].label="文件名",z.value=t},J=t=>{F("addFile",{file:t.file,filePid:f.value.id})},L=()=>{w.filename=D.value,E()},ae=t=>{if(t.folderType==1){R.value.openFolder(t);return}if(t.status!=2){te.warning("文件未完成转码，无法预览");return}h.value.showPreview(t,0)},Q=()=>{_.value||(i.value.setRowFieldValue("showEdit",!1),_.value=!0,i.value.unshiftRow({showEdit:!0,folderType:1,id:"",filePid:f.value.id,filenameReal:"",updateTime:Ve("YY-mm-dd HH:MM",new Date)}),se(()=>{s.value.focus()}))},ie=t=>{var c,x;O(t)||(i.value.tableElRef.data[0].id==""&&i.value.tableElRef.data.splice(0,1),i.value.setRowFieldValue("showEdit",!1),t.showEdit=!0,_.value=!0,t.folderType==0?(t.filenameReal=(c=t.filename)==null?void 0:c.substring(0,t.filename.lastIndexOf(".")),t.fileSuffix=(x=t.filename)==null?void 0:x.substring(t.filename.lastIndexOf("."))):(t.filenameReal=t.filename,t.fileSuffix=""),se(()=>{s.value=!0}))},g=t=>{const c=i.value.tableElRef.data[t];c.id?c.showEdit=!1:i.value.tableElRef.data.splice(t,1),_.value=!1},re=async t=>{i.value.setLoading(!0);const{id:c,filePid:x,folderType:ee,filenameReal:N}=i.value.tableElRef.data[t];if(N==""||N.indexOf("/")!=-1){te.warning(`文件${ee==1?"夹":""}名不能为空，且不能含有 '/'`);return}if(c=="")try{const B=await Te({filePid:x,filename:N});i.value.setRowValue(B,0)}catch{g(0)}else try{const B=await ze({id:c,filename:N});i.value.setRowValue(B,t)}catch{g(0)}_.value=!1,i.value.setLoading(!1)},ge=async t=>{if(O(t))return;const c=b[0].createDownloadUrl+"/"+t.id,x=await Ee(c);x&&(window.location.href=b[0].downloadUrl+"/"+x.code)};return S({reloadTable:E}),(t,c)=>{const x=k("el-icon"),ee=k("el-button"),N=k("el-upload"),B=k("el-button-group"),ue=k("el-input");return a(),u("div",Vt,[e("div",Tt,[e("div",zt,[e("div",Et,[e("div",At,[M(e("div",Pt,[e("div",It,[l(N,{"show-file-list":!1,"with-credentials":!0,multiple:!0,"http-request":J,accept:p.value},{default:o(()=>[l(ee,{type:"primary",round:"",style:{padding:"8px 24px"}},{default:o(()=>[l(x,{size:"16"},{default:o(()=>[l($(Qe))]),_:1}),P(" 上传")]),_:1})]),_:1},8,["accept"])])],512),[[H,z.value.length==0]]),M(e("div",Mt,[e("div",Ot,[l(B,null,{default:o(()=>[M(l(ee,{text:"",round:"",type:"primary",bg:"",onClick:Q},{default:o(()=>[l(x,{size:"16"},{default:o(()=>[l($(Ze))]),_:1}),P("新建文件夹 ")]),_:1},512),[[H,w.category=="all"]])]),_:1})])],512),[[H,z.value.length==0]]),M(e("div",Ut,[l($(pe),{value:z.value,actions:$(v)},null,8,["value","actions"])],512),[[H,z.value.length>0]])])]),e("div",Dt,[e("div",Nt,[l(ue,{modelValue:D.value,"onUpdate:modelValue":c[0]||(c[0]=A=>D.value=A),size:"small",clearable:"",placeholder:"搜索我的文件","input-style":"height: 32px",onKeyup:_e(L,["enter"]),onClear:L},{suffix:o(()=>[e("span",{class:"text",onClick:L},"搜索")]),_:1},8,["modelValue","onKeyup"])])])])]),e("div",Bt,[e("div",Ht,[e("div",Lt,[e("div",jt,[l(ce,{ref_key:"navigationRef",ref:R,onNavChange:G},null,512)])])]),e("div",Kt,[l($(Pe),{ref_key:"dataTableRef",ref:i,columns:y.value,"row-key":A=>A.id,request:X,loading:!0,onSelectChange:K},{filename:o(({index:A,row:d})=>[e("div",qt,[(d.fileType==3||d.fileType==1)&&d.status==2?(a(),W(I,{key:0,cover:d.fileCover,width:32},null,8,["cover"])):(a(),u(le,{key:1},[d.folderType==0?(a(),W(I,{key:0,"file-type":d.fileType},null,8,["file-type"])):(a(),W(I,{key:1,"file-type":0}))],64)),d.showEdit?Y("",!0):(a(),u("span",Wt,[e("span",{class:"text",onClick:fe(q=>ae(d),["stop"])},U(d.filename),9,Yt),d.status==0?(a(),u("span",Zt,"转码中")):Y("",!0),d.status==1?(a(),u("span",Gt,"转码失败")):Y("",!0)])),d.showEdit?(a(),u("div",{key:3,class:"edit-panel",onClick:c[1]||(c[1]=fe(()=>{},["stop"]))},[l(ue,{modelValue:d.filenameReal,"onUpdate:modelValue":q=>d.filenameReal=q,modelModifiers:{trim:!0},ref_key:"editNameRef",ref:s,size:"small",maxLength:190,onKeyup:_e(q=>re(A),["enter"])},{suffix:o(()=>[P(U(d.fileSuffix),1)]),_:2},1032,["modelValue","onUpdate:modelValue","onKeyup"]),e("div",Xt,[e("span",{class:"iconfont icon-check",onClick:q=>re(A)},null,8,Jt)]),e("div",Qt,[e("span",{class:"iconfont icon-close",onClick:q=>g(A)},null,8,el)])])):Y("",!0)])]),RowAction:o(({index:A,row:d})=>[(a(),W($(pe),{mode:"row",value:d,field:"updateTime",key:d.showEdit,actions:$(v),offset:-130},null,8,["value","actions"]))]),fileSize:o(({index:A,row:d})=>[e("div",tl,[d.fileSize?(a(),u("span",ll,U($(Se)(d.fileSize)),1)):(a(),u("span",sl," - "))])]),empty:o(()=>[e("div",ol,[e("div",al,[e("div",il,[e("div",nl,[l(I,{"icon-name":"empty",width:120,height:"auto"})]),cl,e("div",dl,[e("div",rl,[l(N,{"show-file-list":!1,"with-credentials":!0,multiple:!0,"http-request":J,accept:p.value},{default:o(()=>[e("div",ul,[e("div",_l,[l(I,{"icon-name":"empty_upload",width:42})]),fl])]),_:1},8,["accept"]),M(e("div",{class:"action-item",onClick:Q},[e("div",pl,[l(I,{"icon-name":"empty_newFolder",width:42})]),hl],512),[[H,w.category=="all"]])])])])])])]),_:1},8,["columns","row-key"])])]),l(we,{ref_key:"previewRef",ref:h},null,512),l($(Ie),{ref_key:"deleteFileRef",ref:C,onDeleteSuccess:E},null,512),l($(ut),{ref_key:"moveFileRef",ref:V,onMoveSuccess:E},null,512),l($(St),{ref_key:"shareFileRef",ref:n},null,512)])}}}),kl=ne(vl,[["__scopeId","data-v-a46e94d8"]]);export{kl as default};
