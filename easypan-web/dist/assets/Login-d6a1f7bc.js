import{d as U,o as i,c,a,_ as H,F as X,r as Y,n as A,u as Z,b as ee,e as h,f as T,V as j,g as te,E as S,h as x,i as t,w as o,j as v,k as M,l as m,m as w,p as oe,t as le,q as se,s as ae,v as re,x as ne,y as ie,z as de,P as ue}from"./index-cd067b4e.js";import{s as ce,L as R,r as pe,l as me,a as fe}from"./user-7ab5ada6.js";const _e={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},ve=a("path",{d:"M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 110.8V792H136V270.8l-27.6-21.5l39.3-50.5l42.8 33.3h643.1l42.8-33.3l39.3 50.5l-27.7 21.5zM833.6 232L512 482L190.4 232l-42.8-33.3l-39.3 50.5l27.6 21.5l341.6 265.6a55.99 55.99 0 0 0 68.7 0L888 270.8l27.6-21.5l-39.3-50.5l-42.7 33.2z",fill:"currentColor"},null,-1),ge=[ve],he=U({name:"MailOutlined",render:function(_,p){return i(),c("svg",_e,ge)}}),we={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},ke=a("path",{d:"M866.9 169.9L527.1 54.1C523 52.7 517.5 52 512 52s-11 .7-15.1 2.1L157.1 169.9c-8.3 2.8-15.1 12.4-15.1 21.2v482.4c0 8.8 5.7 20.4 12.6 25.9L499.3 968c3.5 2.7 8 4.1 12.6 4.1s9.2-1.4 12.6-4.1l344.7-268.6c6.9-5.4 12.6-17 12.6-25.9V191.1c.2-8.8-6.6-18.3-14.9-21.2zM810 654.3L512 886.5L214 654.3V226.7l298-101.6l298 101.6v427.6zm-405.8-201c-3-4.1-7.8-6.6-13-6.6H336c-6.5 0-10.3 7.4-6.5 12.7l126.4 174a16.1 16.1 0 0 0 26 0l212.6-292.7c3.8-5.3 0-12.7-6.5-12.7h-55.2c-5.1 0-10 2.5-13 6.6L468.9 542.4l-64.7-89.1z",fill:"currentColor"},null,-1),ye=[ke],I=U({name:"SafetyCertificateOutlined",render:function(_,p){return i(),c("svg",we,ye)}}),xe={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},Ce=a("path",{d:"M858.5 763.6a374 374 0 0 0-80.6-119.5a375.63 375.63 0 0 0-119.5-80.6c-.4-.2-.8-.3-1.2-.5C719.5 518 760 444.7 760 362c0-137-111-248-248-248S264 225 264 362c0 82.7 40.5 156 102.8 201.1c-.4.2-.8.3-1.2.5c-44.8 18.9-85 46-119.5 80.6a375.63 375.63 0 0 0-80.6 119.5A371.7 371.7 0 0 0 136 901.8a8 8 0 0 0 8 8.2h60c4.4 0 7.9-3.5 8-7.8c2-77.2 33-149.5 87.8-204.3c56.7-56.7 132-87.9 212.2-87.9s155.5 31.2 212.2 87.9C779 752.7 810 825 812 902.2c.1 4.4 3.6 7.8 8 7.8h60a8 8 0 0 0 8-8.2c-1-47.8-10.9-94.3-29.5-138.2zM512 534c-45.9 0-89.1-17.9-121.6-50.4S340 407.9 340 362c0-45.9 17.9-89.1 50.4-121.6S466.1 190 512 190s89.1 17.9 121.6 50.4S684 316.1 684 362c0 45.9-17.9 89.1-50.4 121.6S557.9 534 512 534z",fill:"currentColor"},null,-1),be=[Ce],Ve=U({name:"UserOutlined",render:function(_,p){return i(),c("svg",xe,be)}});const Me={props:{rainNumber:{type:Number,default:0},rotateDeg:{type:Number,default:0},w:{type:Number,default:0},h:{type:Number,default:0}},mounted(){this.randomRain()},methods:{randomRain(){this.$refs.rainItem.forEach(_=>{_.style.top=Math.floor(Math.random()*100+1)+"px",_.style.left=Math.floor(Math.random()*2300+1)+"px"})}}},Le={class:"rain"};function $e(f,_,p,O,C,P){return i(),c("div",Le,[(i(!0),c(X,null,Y(p.rainNumber,(L,r)=>(i(),c("div",{key:r,class:"rain-item",ref_for:!0,ref:"rainItem",style:A(`transform: rotate(${p.rotateDeg}deg); width: ${p.w}px; height: ${p.h}px; top: ${L.top}px; left: ${L.left}px;`)},[a("div",{class:"line",style:A(`animationDelay: ${r*100}ms`)},null,4)],4))),128))])}const qe=H(Me,[["render",$e],["__scopeId","data-v-7f98da94"]]);const K=f=>(ie("data-v-605946c3"),f=f(),de(),f),Se={class:"login-body"},Pe={class:"login-panel"},Ne=K(()=>a("div",{class:"login-title"},"魔女云盘",-1)),Re={key:1},Ie={class:"send-email-panel"},Ue=K(()=>a("div",null,[a("p",null,"1、在垃圾箱中查找邮箱验证码"),a("p",null,"2、在邮箱中头像->设置->反垃圾->白名单->设置邮箱地址白名单"),a("p",null,"3、将邮箱【2627.311935@qq.com】添加到白名单")],-1)),Oe={class:"check-code-panel"},ze=["src"],Ee={class:"no-account"},Be={class:"no-account"},De={class:"no-account"},Fe={key:0},Ae={key:1},Te={key:2},je={key:5,class:"login-btn-qq"},He={class:"check-code-panel"},Ke=["src"],Ge={__name:"Login",setup(f){const _=Z(),p=ee(),O=ue.BASE_LOGIN_NAME,C={checkCode:"/api/checkCode",qqLogin:"/api/qqLogin"},P=async()=>{try{const e=(await ae.post(C.qqLogin,{})).data;window.location.href=e}catch(n){console.error(n)}},L=(n,e,u)=>{e!==s.value.registerPassword?u(new Error(n.message)):u()},r=h(1),$=h(),s=h({email:""}),z=T({email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{validator:j.email,message:"请输入正确的邮箱",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],nickname:[{required:!0,message:"请输入昵称",trigger:"blur"}],registerPassword:[{required:!0,message:"请输入密码",trigger:"blur"},{validator:j.password,message:"密码只能是数字, 字母, 特殊字符8-18位",trigger:"blur"}],reRegisterPassword:[{required:!0,message:"请再次输入密码",trigger:"blur"},{validator:L,message:"两次密码不一致",trigger:"blur"}],checkCode:[{required:!0,message:"请输入图片验证码"}],emailCode:[{required:!0,message:"请输入邮箱验证码"}]}),b=h({}),N=h(),k=T({show:!1,title:"发送邮箱验证码",buttons:[{type:"primary",text:"发送验证码",click:n=>{Q()}}]}),E=h(C.checkCode),B=h(C.checkCode);te(()=>{g(1),s.value={email:"",password:""}});const g=n=>{r.value=n,J()};function y(n){const e=C.checkCode+"?type="+n+"&time="+new Date().getTime();n==0?E.value=e:B.value=e}function G(){$.value.validateField("email",n=>{n&&(k.show=!0,re(()=>{y(1),N.value.resetFields(),b.value={email:s.value.email}}))})}const J=()=>{y(0),$.value.resetFields(),s.value={}},Q=()=>{N.value.validate(async n=>{if(!n)return;const e=Object.assign({},b.value);e.type=r.value==0?0:1;try{await ce(e),S.success("验证码发送成功，请登陆邮箱查看"),k.show=!1}catch{y(1)}})},D=()=>{$.value.validate(async n=>{var u;if(!n)return;let e={};Object.assign(e,s.value),(r.value==0||r.value==2)&&(e.password=e.reRegisterPassword,delete e.reRegisterPassword,delete e.registerPassword);try{switch(r.value){case 0:{await fe(e),S.success("注册成功，请登陆"),g(1);break}case 1:{const d=await me(e);S.success("登陆成功"),ne.set("userInfo",JSON.stringify(d),0);const q=decodeURIComponent(((u=_.query)==null?void 0:u.redirect)||"/");_.name==O?p.replace("/"):p.replace(q);break}case 2:{await pe(e),S.success("密码重置成功，请登陆"),g(1);break}}}catch{y(0)}})};return(n,e)=>{const u=x("el-input"),d=x("el-form-item"),q=x("el-button"),V=x("el-link"),W=x("el-popover"),F=x("el-form");return i(),c("div",Se,[t(qe,{rainNumber:7,rotateDeg:60,w:1,h:140}),a("div",Pe,[t(F,{model:s.value,rules:z,ref_key:"loginFormRef",ref:$,class:"login-register"},{default:o(()=>[Ne,t(d,{prop:"email"},{default:o(()=>[t(u,{clearable:"",placeholder:"请输入邮箱",modelValue:s.value.email,"onUpdate:modelValue":e[0]||(e[0]=l=>s.value.email=l),modelModifiers:{trim:!0},"prefix-icon":v(he),maxLength:"150"},null,8,["modelValue","prefix-icon"])]),_:1}),r.value==1?(i(),M(d,{key:0,prop:"password"},{default:o(()=>[t(u,{"show-password":"",type:"password",placeholder:"请输入密码",modelValue:s.value.password,"onUpdate:modelValue":e[1]||(e[1]=l=>s.value.password=l),modelModifiers:{trim:!0},"prefix-icon":v(R),maxLength:"20"},null,8,["modelValue","prefix-icon"])]),_:1})):m("",!0),r.value==0||r.value==2?(i(),c("div",Re,[t(d,{prop:"emailCode"},{default:o(()=>[a("div",Ie,[t(u,{placeholder:"请输入邮箱验证码",modelValue:s.value.emailCode,"onUpdate:modelValue":e[2]||(e[2]=l=>s.value.emailCode=l),modelModifiers:{trim:!0},"prefix-icon":v(I)},null,8,["modelValue","prefix-icon"]),t(q,{class:"send-mail-btn",type:"primary",onClick:G},{default:o(()=>[w("获取邮箱验证码")]),_:1})]),t(W,{placement:"left",width:500,trigger:"click"},{reference:o(()=>[t(V,{type:"primary",underline:!1},{default:o(()=>[w("未收到邮箱验证码？")]),_:1})]),default:o(()=>[Ue]),_:1})]),_:1}),r.value==0?(i(),M(d,{key:0,prop:"nickname"},{default:o(()=>[t(u,{placeholder:"请输入昵称",modelValue:s.value.nickname,"onUpdate:modelValue":e[3]||(e[3]=l=>s.value.nickname=l),modelModifiers:{trim:!0},"prefix-icon":v(Ve),maxLength:"20"},null,8,["modelValue","prefix-icon"])]),_:1})):m("",!0),t(d,{prop:"registerPassword"},{default:o(()=>[t(u,{"show-password":"",type:"password",placeholder:"请输入密码",modelValue:s.value.registerPassword,"onUpdate:modelValue":e[4]||(e[4]=l=>s.value.registerPassword=l),modelModifiers:{trim:!0},"prefix-icon":v(R),maxLength:"20"},null,8,["modelValue","prefix-icon"])]),_:1}),t(d,{prop:"reRegisterPassword"},{default:o(()=>[t(u,{"show-password":"",type:"password",placeholder:"请再次输入密码",modelValue:s.value.reRegisterPassword,"onUpdate:modelValue":e[5]||(e[5]=l=>s.value.reRegisterPassword=l),modelModifiers:{trim:!0},"prefix-icon":v(R),maxLength:"20"},null,8,["modelValue","prefix-icon"])]),_:1})])):m("",!0),t(d,{prop:"checkCode"},{default:o(()=>[a("div",Oe,[t(u,{placeholder:"请输入验证码",modelValue:s.value.checkCode,"onUpdate:modelValue":e[6]||(e[6]=l=>s.value.checkCode=l),modelModifiers:{trim:!0},"prefix-icon":v(I),onKeyup:oe(D,["enter"])},null,8,["modelValue","prefix-icon","onKeyup"]),a("img",{src:E.value,class:"check-code",onClick:e[7]||(e[7]=l=>y(0))},null,8,ze)])]),_:1}),r.value==1?(i(),M(d,{key:2},{default:o(()=>[a("div",Ee,[t(V,{type:"primary",underline:!1,onClick:e[8]||(e[8]=l=>g(2))},{default:o(()=>[w("忘记密码？")]),_:1}),t(V,{type:"primary",underline:!1,onClick:e[9]||(e[9]=l=>g(0))},{default:o(()=>[w("没有账号？")]),_:1})])]),_:1})):m("",!0),r.value==2?(i(),M(d,{key:3},{default:o(()=>[a("div",Be,[t(V,{type:"primary",underline:!1,onClick:e[10]||(e[10]=l=>g(1))},{default:o(()=>[w("去登陆")]),_:1})])]),_:1})):m("",!0),r.value==0?(i(),M(d,{key:4},{default:o(()=>[a("div",De,[t(V,{type:"primary",underline:!1,onClick:e[11]||(e[11]=l=>g(1))},{default:o(()=>[w("已有账号？")]),_:1})])]),_:1})):m("",!0),t(d,null,{default:o(()=>[t(q,{type:"primary",style:{width:"100%"},onClick:D},{default:o(()=>[r.value==0?(i(),c("span",Fe,"注册")):m("",!0),r.value==1?(i(),c("span",Ae,"登陆")):m("",!0),r.value==2?(i(),c("span",Te,"重置密码")):m("",!0)]),_:1})]),_:1}),r.value==1?(i(),c("div",je,[a("span",{onClick:P,class:"clickable"},"快捷登陆"),a("img",{onClick:P,class:"clickable",src:"https://passport.baidu.com/passApi/img/bd-acc-qzone.png"})])):m("",!0)]),_:1},8,["model","rules"])]),t(se,{show:k.show,title:k.title,buttons:k.buttons,width:"500px",showCancel:!1,onClose:e[14]||(e[14]=l=>k.show=!1)},{default:o(()=>[t(F,{model:b.value,rules:z,"label-width":"80px",ref_key:"formRef4SendMailCode",ref:N},{default:o(()=>[t(d,{label:"邮箱"},{default:o(()=>[w(le(s.value.email),1)]),_:1}),t(d,{label:"验证码",prop:"checkCode"},{default:o(()=>[a("div",He,[t(u,{placeholder:"请输入验证码",modelValue:b.value.checkCode,"onUpdate:modelValue":e[12]||(e[12]=l=>b.value.checkCode=l),modelModifiers:{trim:!0},"prefix-icon":v(I)},null,8,["modelValue","prefix-icon"]),a("img",{src:B.value,class:"check-code",onClick:e[13]||(e[13]=l=>y(1))},null,8,Ke)])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["show","title","buttons"])])}}},We=H(Ge,[["__scopeId","data-v-605946c3"]]);export{We as default};
