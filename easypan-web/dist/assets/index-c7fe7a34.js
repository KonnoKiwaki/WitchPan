import{_ as M,e as u,f as j,h as p,o as g,c as y,a as r,i as t,w as o,p as A,Q as O,m,t as v,j as x,I as B,l as I,a1 as q,q as P,F as G,S as Q,E as _,s as S,v as W}from"./index-cd067b4e.js";import{B as H}from"./Table-58a1515f.js";const J=[{label:"昵称",prop:"nickname"},{label:"头像",prop:"avatar",scopedSlots:"avatar",width:80},{label:"邮箱",prop:"email",ellipsis:!0},{label:"空间使用",prop:"space",scopedSlots:"space",ellipsis:!0},{label:"加入时间",prop:"createTime",ellipsis:!0},{label:"最后登陆时间",prop:"lastLoginTime",ellipsis:!0},{label:"状态",prop:"status",scopedSlots:"status",width:80},{label:"操作",prop:"op",scopedSlots:"op",width:150}];const X={class:"main-user"},Y={class:"main-header"},Z={class:"actions"},ee={class:"select"},ae={class:"search"},te={class:"main-body"},se={class:"file-list"},le={key:0,style:{color:"#529b2e"}},oe={key:1,style:{color:"#f56c62"}},ne={name:"UserSetting"},ce=Object.assign(ne,{setup(re){const R=e=>{const a=e.status==0?"启用":"禁用";Q.confirm(`你确定要【${a}】此账号吗？`,"Warning",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning",center:!0}).then(()=>{_({type:"success",message:"修改完成"});let s=e.id.match(/\d+/)[0];return S.post("/api/admin/updateUserStatus",{userId:s,status:e.status==0?1:0})}).then(s=>{s.data?w():console.error("修改失败")}).catch(s=>{console.error("修改失败")})},U=u(),$=u([]),h=u(J),f=j({select:"",filename:""}),d=u({show:!1,title:"修改空间大小",buttons:[{type:"primary",text:"确定",click:e=>{D()}}]}),i=u({}),k=u(),z={changeSpace:[{required:!0,message:"请输入空间大小"}]},D=()=>{S.post("/api/admin/updateUserSpace",{userId:i.value.id,changeSpace:i.value.changeSpace}).then(e=>{e.data.code===-1?_({type:"error",message:e.data.message}):(_({type:"success",message:"修改成功"}),d.value.show=!1)}).catch(e=>{_({type:"error",message:"修改失败"})})},w=async()=>{let e={pageNo:1,pageSize:30};try{return{records:(await S.post("/api/admin/loadUserList",e)).data.map(c=>({id:c.id,avatar:c.qqAvatar,nickname:c.nickname,email:c.email,useSpace:c.useSpace,totalSpace:c.totalSpace,createTime:c.createTime,lastLoginTime:c.lastLoginTime,status:c.status}))}}catch{return _({showClose:!0,message:"无操作权限，请联系管理员",type:"error"}),{pages:0,records:[]}}},E=e=>{e.length>0?h.value[0].label=`已选中${e.length}个用户`:h.value[0].label="昵称";const a=e.map(s=>(s.id=s.userId+"_"+s.id,s));$.value=a},F=e=>{d.value.show=!0,W(()=>{k.value.resetFields(),i.value=Object.assign({},e)})},b=()=>{};return(e,a)=>{const s=p("el-option"),c=p("el-select"),C=p("el-input"),T=p("el-button"),N=p("el-divider"),V=p("el-form-item"),K=p("el-form");return g(),y(G,null,[r("div",X,[r("div",Y,[r("div",Z,[r("div",ee,[t(c,{modelValue:f.select,"onUpdate:modelValue":a[0]||(a[0]=n=>f.select=n),class:"status-select",placeholder:"状态",teleported:!1,style:{width:"80px"}},{default:o(()=>[t(s,{label:"启用",value:"1"}),t(s,{label:"禁用",value:"0"})]),_:1},8,["modelValue"])]),r("div",ae,[t(C,{modelValue:f.filename,"onUpdate:modelValue":a[1]||(a[1]=n=>f.filename=n),modelModifiers:{trim:!0},size:"small",clearable:"",placeholder:"搜索我的文件","input-style":"height: 32px",onKeyup:A(b,["enter"]),onClear:b,class:"input-with-select"},{suffix:o(()=>[r("span",{class:"text",onClick:b},"搜索")]),_:1},8,["modelValue","onKeyup"])])])]),r("div",te,[r("div",se,[t(x(H),{ref_key:"userTableRef",ref:U,columns:h.value,"row-key":n=>n.id,request:w,loading:!0,onSelectChange:E},{avatar:o(({index:n,row:l})=>[t(O,{userId:l.id.match(/\d+/)[0],avatar:l.qqAvatar},null,8,["userId","avatar"])]),space:o(({index:n,row:l})=>[m(v(x(B)(l.useSpace))+" / "+v(x(B)(l.totalSpace)),1)]),status:o(({index:n,row:l})=>[l.status==1?(g(),y("span",le,"启用")):I("",!0),l.status==0?(g(),y("span",oe,"禁用")):I("",!0)]),op:o(({index:n,row:l})=>[t(T,{link:"",type:"primary",style:{"font-size":"12px"},onClick:q(L=>F(l),["stop"])},{default:o(()=>[m("分配空间")]),_:2},1032,["onClick"]),t(N,{direction:"vertical"}),t(T,{type:l.status==0?"success":"danger",link:"",style:{"font-size":"12px"},onClick:L=>R(l)},{default:o(()=>[m(v(l.status==0?"启用":"禁用"),1)]),_:2},1032,["type","onClick"])]),_:1},8,["columns","row-key"])])])]),t(P,{show:d.value.show,title:d.value.title,buttons:d.value.buttons,width:"500px",showCancel:!1,onClose:a[4]||(a[4]=n=>d.value.show=!1)},{default:o(()=>[t(K,{model:i.value,rules:z,ref_key:"formDataRef",ref:k,"label-width":"80px",onSubmit:a[3]||(a[3]=q(()=>{},["prevent"]))},{default:o(()=>[t(V,{label:"昵称"},{default:o(()=>[m(v(i.value.nickname),1)]),_:1}),t(V,{label:"空间大小",prop:"changeSpace"},{default:o(()=>[t(C,{clearable:"",placeholder:"请输入空间大小",modelValue:i.value.changeSpace,"onUpdate:modelValue":a[2]||(a[2]=n=>i.value.changeSpace=n)},{suffix:o(()=>[m("GB")]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title","buttons"])],64)}}}),de=M(ce,[["__scopeId","data-v-2f9c7bed"]]);export{de as default};
