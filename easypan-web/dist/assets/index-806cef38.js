import{r as n,e as W,g as $,o as a,c as _,a as s,h as c,w as f,m as L,x as j,y as q,i as d,j as m,F as O,K as G,t as I,k as H,E as J,p as Q,n as X}from"./index-ea894644.js";import{I as h,f as Y}from"./Icon-9aaaa943.js";import{B as Z}from"./Table-3fbda55d.js";import{i as x,s as ee}from"./setting-8d83341a.js";import{_ as E,N as se,D as te}from"./DeleteFile-cbe2613f.js";import{a as ie,b as oe}from"./file-9dac2eef.js";import{_ as B}from"./ShareFile.vue_vue_type_style_index_0_scoped_425f0df5_lang-c0a08c93.js";import"./Dialog-65b9ab6b.js";import{_ as ae}from"./_plugin-vue_export-helper-c27b6911.js";import"./index-75dd74c6.js";const le=({deleteFile:r,downloadFile:v})=>[{title:"下载",label:"download",icon:"download",showLabel:!0,isShow:l=>!x(l)||x(l)&&l.filter(y=>y.folderType===1).length===0,onClick:l=>{v(l)}},{title:"删除",label:"delete",icon:"delete",showLabel:!0,onClick:l=>{r(l)}}];const N=r=>(Q("data-v-3bf78bb3"),r=r(),X(),r),ne={class:"main"},ce={class:"main-header"},de={class:"actions"},re={class:"search"},pe={class:"file-action"},_e={class:"main-body"},fe={class:"nav"},ue={class:"nav-list"},me={class:"nav-left"},he={class:"file-list"},ve={class:"file-item"},ye={key:2,class:"file-name"},be=["onClick"],we={class:"file-size"},ge={key:0},ke={key:1},Se={class:"table-empty"},xe={class:"main-empty"},Fe={class:"u-empty"},Ce={class:"empty-image"},Te=N(()=>s("div",{class:"empty-description"},[s("span",{class:"text"},"当前列表为空，上传你的第一个文件吧")],-1)),Re=N(()=>s("div",{class:"empty-bottom"},[s("div",{class:"empty-action"})],-1)),ze={name:"Main",components:{Preview:E}},De=Object.assign(ze,{emits:["addFile"],setup(r,{expose:v,emit:l}){const y=[{label:"文件名",prop:"filename",scopedSlots:"filename",ellipsis:!0,minWidth:"40%"},{label:"发布人",prop:"nickname",minWidth:"20%"},{label:"修改时间",prop:"updateTime",minWidth:"20%",scopedSlots:"RowAction"},{label:"大小",prop:"fileSize",scopedSlots:"fileSize",minWidth:"20%"}],{fileUrlMap:F}=Y,C=n(),T=n(),R=n(),z=n(),b=n(),w=n([]),V=n({id:"0"}),g=n(y),k=W({page:1,pageSize:20,filePid:"0"}),D=le({deleteFile:e=>{z.value.show(e)},downloadFile:async e=>{P(e)}});function u(){var e;(e=C.value)==null||e.reload()}function U(e){const{curFolder:i}=e;k.filePid=i.id,V.value=i,u()}const A=async e=>{const i={...e,...k};try{return ie(i)}catch{return[]}},K=e=>{e.length>0?g.value[0].label=`已选中${e.length}个文件/文件夹`:g.value[0].label="文件名";const i=e.map(o=>(o.id=o.userId+"_"+o.id,o));w.value=i},S=()=>{k.filename=b.value,u()},M=e=>{if(e.folderType==1){T.value.openFolder(e);return}if(e.status!=2){J.warning("文件未完成转码，无法预览");return}R.value.showPreview(e,1)},P=async e=>{if(x(e))return;const i=F[1].createDownloadUrl+"/"+e.userId+"/"+e.id,o=await oe(i);o&&(window.location.href=F[1].downloadUrl+"/"+o.code)};return v({reloadTable:u}),(e,i)=>{const o=$("el-input");return a(),_("div",ne,[s("div",ce,[s("div",de,[s("div",re,[c(o,{modelValue:b.value,"onUpdate:modelValue":i[0]||(i[0]=p=>b.value=p),size:"small",clearable:"",placeholder:"搜索我的文件","input-style":"height: 32px",onKeyup:L(S,["enter"]),onClear:S},{suffix:f(()=>[s("span",{class:"text",onClick:S},"搜索")]),_:1},8,["modelValue","onKeyup"])]),j(s("div",pe,[c(d(B),{value:w.value,actions:d(D)},null,8,["value","actions"])],512),[[q,w.value.length>0]])])]),s("div",_e,[s("div",fe,[s("div",ue,[s("div",me,[c(se,{ref_key:"navigationRef",ref:T,onNavChange:U},null,512)])])]),s("div",he,[c(d(Z),{ref_key:"dataTableRef",ref:C,columns:g.value,"row-key":p=>p.id,request:A,loading:!0,onSelectChange:K},{filename:f(({index:p,row:t})=>[s("div",ve,[(t.fileType==3||t.fileType==1)&&t.status==2?(a(),m(h,{key:0,cover:t.fileCover,width:32},null,8,["cover"])):(a(),_(O,{key:1},[t.folderType==0?(a(),m(h,{key:0,"file-type":t.fileType},null,8,["file-type"])):(a(),m(h,{key:1,"file-type":0}))],64)),t.showEdit?H("",!0):(a(),_("span",ye,[s("span",{class:"text",onClick:G(Ie=>M(t),["stop"])},I(t.filename),9,be)]))])]),RowAction:f(({index:p,row:t})=>[(a(),m(d(B),{mode:"row",value:t,field:"updateTime",key:t.showEdit,actions:d(D)},null,8,["value","actions"]))]),fileSize:f(({index:p,row:t})=>[s("div",we,[t.fileSize?(a(),_("span",ge,I(d(ee)(t.fileSize)),1)):(a(),_("span",ke," - "))])]),empty:f(()=>[s("div",Se,[s("div",xe,[s("div",Fe,[s("div",Ce,[c(h,{"icon-name":"empty",width:120,height:"auto"})]),Te,Re])])])]),_:1},8,["columns","row-key"])])]),c(E,{ref_key:"previewRef",ref:R},null,512),c(d(te),{ref_key:"deleteFileRef",ref:z,onDeleteSuccess:u},null,512)])}}}),$e=ae(De,[["__scopeId","data-v-3bf78bb3"]]);export{$e as default};
