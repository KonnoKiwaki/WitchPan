import{_ as G,u as J,b as K,e as p,a9 as oe,o as l,c as r,l as C,F as L,a as e,r as ne,A as le,t as I,s as w,y as Q,z as W,L as ce,h as E,a0 as ie,B as re,i as N,k as T,w as D,m as q,j as H,a1 as de,aa as he,ab as pe,a2 as ue,E as M}from"./index-cd067b4e.js";const A=d=>(Q("data-v-a122ea05"),d=d(),W(),d),_e={class:"nav-list"},ve={key:0,class:"all-file"},fe=A(()=>e("span",{class:"item-sep"},"|",-1)),ge={class:"nav-item"},me=A(()=>e("span",{class:"item-sep"},">",-1)),ye=["onClick"],Se=A(()=>e("span",{class:"item-sep"},null,-1)),ke={name:"ShareNavigation"},Ie=Object.assign(ke,{props:{watchPath:{type:Boolean,default:!0}},emits:["nav-change"],setup(d,{expose:g,emit:S}){const m=d,u=J(),h=K(),s=p([]);let y={id:"0"},O="all",_={shareId:"",path:""};function z(t,c){const{id:i,filename:f}=t,x={filename:f,id:i};s.value.push(x),y=x,b()}function b(){if(!m.watchPath){F();return}let t=[];s.value.forEach(c=>{t.push(c.id)}),h.push({path:u.path,query:t.length==0?"":{path:t.join("/")}})}function k(){$(s.value.length-2)}function $(t){t==-1?(y={id:"0"},s.value=[]):(y=s.value[t],s.value.splice(t+1,s.value.length)),b()}const R=async t=>{console.log(t);try{const c=await w.get("/api/showShare/getFolderInfo",{params:{path:t.path,shareId:t.shareId}});console.log(c),c.data&&(s.value=c.data)}catch(c){console.error(c)}};function v(){s.value=[],y={id:"0"},F()}function F(){S("nav-change",{category:O,curFolder:y})}return oe(()=>u,(t,c)=>{if(!m.watchPath||t.path.indexOf("/share")===-1)return;const i=t.query.path;if(O=t.params.category,i==null)v();else{s.value.length==0&&(_.shareId=t.path.split("/").pop(),_.path=i,R(_));let f=i.split("/");y={id:f[f.length-1]},F()}},{immediate:!0,deep:!0}),g({openFolder:z,init:v}),(t,c)=>(l(),r("div",_e,[s.value.length==0?(l(),r("span",ve,"全部文件")):C("",!0),s.value.length>0?(l(),r(L,{key:1},[e("span",{class:"back nav-item"},[e("span",{class:"item-title text-ellip",onClick:k},"返回上一级"),fe]),e("span",ge,[e("span",{class:"item-title text-ellip",onClick:c[0]||(c[0]=i=>$(-1))},"全部文件"),me]),(l(!0),r(L,null,ne(s.value,(i,f)=>(l(),r("span",{class:le(["nav-item",f<s.value.length-1?"":"is-disable-nav"])},[e("span",{class:"item-title text-ellip",onClick:x=>$(f)},I(i.filename),9,ye),Se],2))),256))],64)):C("",!0)]))}}),we=G(Ie,[["__scopeId","data-v-a122ea05"]]);const P=d=>(Q("data-v-48f5172e"),d=d(),W(),d),Ce={class:"share"},be=P(()=>e("span",{class:"iconfont icon-pan"},null,-1)),$e=P(()=>e("span",{class:"name"},"魔女云盘",-1)),Fe=[be,$e],xe={class:"share-body"},Ne={key:0,class:"loading"},Te={class:"share-panel"},Le={class:"share-user-info"},Oe={class:"avatar"},De={class:"share-info"},Me={class:"user-info"},Pe={class:"nick-name"},ze={class:"share-time"},Re={class:"file-name"},je={class:"share-op-btn"},Ue=P(()=>e("span",{class:"iconfont icon-cancel"},null,-1)),Be=P(()=>e("span",{class:"iconfont icon-import"},null,-1)),Ee={class:"file-list"},Ae=["onMouseenter","onMouseleave"],Ve=["title"],qe=["onClick"],He={class:"op"},Ge=["onClick"],Je={key:0},Ke={__name:"Share",setup(d){const{proxy:g}=ce(),S=K(),m=J(),u={getShareLoginInfo:"/api/showShare/getShareLoginInfo",loadFileList:"/api/showShare/loadFileList",createDownloadUrl:"/api/showShare/createDownloadUrl",download:"/api/showShare/download",cancelShare:"/api/showShare/cancelShare",saveShare:"/api/showShare/saveShare"};let h=m.params.shareId;const s=p({});(async()=>{try{let a=await w.get(u.getShareLoginInfo,{params:{shareId:h}});if(a.data.message==="系统错误"){M({type:"error",message:"系统错误,请重新验证"}),S.push("/shareCheck/"+h);return}s.value=a.data}catch(a){M({type:"error",message:a})}})();const O=[{label:"文件名",prop:"filename",scopedSlots:"fileName",align:"left"},{label:"修改时间",prop:"updateTime",width:200,align:"center"},{label:"大小",prop:"fileSize",scopedSlots:"fileSize",width:200,align:"center"}],_=p([]),z={extHeight:80,selectType:"checkbox"};let b=p({id:"0"});const k=async()=>{try{let a={page:_.value.pageNo||1,limit:_.value.pageSize||10,shareId:h,filePid:b.value.id},o=await w.get(u.loadFileList,{params:a});if(!o.data)return;_.value=o.data}catch(a){console.error(a)}},$=a=>{_.value.forEach(o=>{o.showOp=!1}),a.showOp=!0},R=a=>{a.showOp=!1},v=p([]),F=a=>{v.value=[],a.forEach(o=>{v.value.push(o.id)})},t=a=>{const{curFolder:o}=a;b.value=o||{id:"0"},k()};k();const c=p(),i=p(),f=a=>{if(a.folderType==1){c.value.openFolder(a,h);return}a.shareId=h,i.value.showPreview(a,2)},x=async a=>{try{const o=await w.get(`${u.createDownloadUrl}/${h}/${a}`);if(!o.data)return;window.location.href=`${u.download}/${o.data.code}`}catch(o){console.error(o)}},j=p();p();const X=()=>{if(v.value.length!=0){if(!g.VueCookies.get("userInfo")){S.push("/login?redirectUrl="+m.path);return}j.value.showFolderDialog()}};p();const Y=async a=>{try{console.log(m.params.shareId+"666"+v.value+"777"+a),(await w.get(u.saveShare,{params:{shareId:m.params.shareId,shareFileIds:v.value.join(","),myFolderId:a}})).data.message==="不能保存自己的分享"?M.success("不能保存自己的分享"):M.success("保存成功"),k(),j.value.close()}catch(o){console.error(o)}},Z=()=>{g.Confirm("你确定要取消分享吗？",async()=>{try{(await w.post(u.cancelShare,{shareIds:h})).status===200&&(g.Message.success("取消分享成功"),S.push("/"))}catch{g.Message.error("操作失败")}})},ee=()=>{S.push("/")};return(a,o)=>{const ae=E("Avatar"),V=E("el-button"),U=E("Icon"),se=ie("loading");return l(),r("div",Ce,[e("div",{class:"header"},[e("div",{class:"header-content"},[e("div",{class:"logo",onClick:ee},Fe)])]),e("div",xe,[Object.keys(s.value).length==0?re((l(),r("div",Ne,null,512)),[[se,Object.keys(s.value).length==0]]):(l(),r(L,{key:1},[e("div",Te,[e("div",Le,[e("div",Oe,[N(ae,{userId:s.value.userId,avatar:s.value.avatar,width:50},null,8,["userId","avatar"])]),e("div",De,[e("div",Me,[e("span",Pe,I(s.value.nickName),1),e("span",ze,"分享于 "+I(s.value.shareTime),1)]),e("div",Re,"分享文件："+I(s.value.fileName),1)])]),e("div",je,[s.value.currentUser?(l(),T(V,{key:0,type:"primary",onClick:Z},{default:D(()=>[Ue,q("取消分享 ")]),_:1})):(l(),T(V,{key:1,type:"primary",disabled:v.value.length==0,onClick:X},{default:D(()=>[Be,q("保存到我的网盘 ")]),_:1},8,["disabled"]))])]),N(we,{ref_key:"navigationRef",ref:c,onNavChange:t,shareId:H(h)},null,8,["shareId"]),e("div",Ee,[N(he,{columns:O,showPagination:!0,dataSource:_.value,fetch:k,initFetch:!1,options:z,onRowSelected:F},{fileName:D(({index:te,row:n})=>[e("div",{class:"file-item",onMouseenter:B=>$(n),onMouseleave:B=>R(n)},[(n.fileType==3||n.fileType==1)&&n.status!==0?(l(),T(U,{key:0,cover:n.fileCover},null,8,["cover"])):(l(),r(L,{key:1},[n.folderType==0?(l(),T(U,{key:0,fileType:n.fileType},null,8,["fileType"])):C("",!0),n.folderType==1?(l(),T(U,{key:1,fileType:0})):C("",!0)],64)),e("span",{class:"file-name",title:n.filename},[e("span",{class:"text",onClick:de(B=>f(n),["stop"])},I(n.filename),9,qe)],8,Ve),e("span",He,[e("span",{style:{cursor:"pointer"},class:"iconfont icon-download",onClick:B=>x(n.id)},"下载",8,Ge),n.showOp&&!s.value.currentUser?(l(),r(L,{key:0},[],64)):C("",!0)])],40,Ae)]),fileSize:D(({index:te,row:n})=>[n.fileSize?(l(),r("span",Je,I(H(g).Utils.size2Str(n.fileSize)),1)):C("",!0)]),_:1},8,["dataSource"])])],64)),N(pe,{ref_key:"folderSelectRef",ref:j,onFolderSelect:Y},null,512),N(ue,{ref_key:"previewRef",ref:i},null,512)])])}}},We=G(Ke,[["__scopeId","data-v-48f5172e"]]);export{We as default};
