import{d as le,o as a,c as p,a as e,r as d,e as j,E as X,g as k,h as l,w as s,F as ee,v as me,t as U,q as te,J as be,j as W,x as M,l as P,s as xe,i as $,y as B,k as ie,p as he,n as ve,A as ke,m as _e,K as fe}from"./index-ea894644.js";import{I,f as Ce}from"./Icon-9aaaa943.js";import{B as $e}from"./Table-3fbda55d.js";import{i as O,s as Fe,d as Se}from"./setting-8d83341a.js";import{N as ne,_ as ye,D as Re}from"./DeleteFile-cbe2613f.js";import{c as Ve,l as Te,a as ze,n as Ee,r as Ae,b as Pe}from"./file-9dac2eef.js";import{_ as pe}from"./ShareFile.vue_vue_type_style_index_0_scoped_425f0df5_lang-c0a08c93.js";import{_ as we}from"./Dialog-65b9ab6b.js";import{_ as ce}from"./_plugin-vue_export-helper-c27b6911.js";import{u as Ie}from"./index-75dd74c6.js";import{s as Me}from"./share-3d2961f5.js";const Oe={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},Ue=e("path",{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448s448-200.6 448-448S759.4 64 512 64zm193.5 301.7l-210.6 292a31.8 31.8 0 0 1-51.7 0L318.5 484.9c-3.8-5.3 0-12.7 6.5-12.7h46.9c10.2 0 19.9 4.9 25.9 13.3l71.2 98.8l157.2-218c6-8.3 15.6-13.3 25.9-13.3H699c6.5 0 10.3 7.4 6.5 12.7z",fill:"currentColor"},null,-1),De=[Ue],Ne=le({name:"CheckCircleFilled",render:function(S,F){return a(),p("svg",Oe,De)}}),He={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},Be=e("path",{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448s448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372s372 166.6 372 372s-166.6 372-372 372z",fill:"currentColor"},null,-1),Le=e("path",{d:"M464 688a48 48 0 1 0 96 0a48 48 0 1 0-96 0zm24-112h48c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8z",fill:"currentColor"},null,-1),je=[Be,Le],Ke=le({name:"ExclamationCircleOutlined",render:function(S,F){return a(),p("svg",He,je)}}),qe={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},We=e("path",{d:"M484 443.1V528h-84.5c-4.1 0-7.5 3.1-7.5 7v42c0 3.8 3.4 7 7.5 7H484v84.9c0 3.9 3.2 7.1 7 7.1h42c3.9 0 7-3.2 7-7.1V584h84.5c4.1 0 7.5-3.2 7.5-7v-42c0-3.9-3.4-7-7.5-7H540v-84.9c0-3.9-3.1-7.1-7-7.1h-42c-3.8 0-7 3.2-7 7.1zm396-144.7H521L403.7 186.2a8.15 8.15 0 0 0-5.5-2.2H144c-17.7 0-32 14.3-32 32v592c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V330.4c0-17.7-14.3-32-32-32zM840 768H184V256h188.5l119.6 114.4H840V768z",fill:"currentColor"},null,-1),Ye=[We],Je=le({name:"FolderAddOutlined",render:function(S,F){return a(),p("svg",qe,Ye)}}),Ze={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},Ge=e("path",{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 0 0-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z",fill:"currentColor"},null,-1),Qe=[Ge],Xe=le({name:"UploadOutlined",render:function(S,F){return a(),p("svg",Ze,Qe)}}),et={all:{accept:"*"},video:{accept:".mp4, .avi, .rmvb, .mkv, .mov .flv"},music:{accept:".mp3, .wav, .wma, .mp2, .flac, .midi, .ra, .ape, .aac, .cda"},image:{accept:".jpeg, .jpg, .png, .gif, .bmp, .dds, .psd, .pdt, .webp, .xmp, .svg, .tiff"},doc:{accept:".pdf, .doc, .docx, .xlsx, .excel, .txt"},other:{accept:"*"}},tt={class:"selector-body"},lt={class:"navigation-panel"},ot={class:"table"},st={key:0,class:"folder-list"},at=["onClick"],it={class:"folder-name"},nt={key:1,class:"empty"},ct={class:"text"},dt={name:"FolderSelect",components:{Navigation:ne}},rt=Object.assign(dt,{emits:["move-success"],setup(h,{expose:S,emit:F}){const T=d(),b=d([]),i=d({});let o=[],R=[],m={filePid:"0"};const C=j({show:!1,title:"移动到",showCancel:!0,buttons:[{type:"primary",text:"移动到此",round:!0,click:r=>{D()}}]}),V=async()=>{try{const r=await Te(m);if(!r)return;b.value=r}catch{C.show=!1}},n=r=>{const{curFolder:v}=r;i.value=v,m.filePid=v.id,V()},_=r=>{T.value.openFolder(r)},D=async()=>{if(R.includes(m.filePid))return X.info("文件正在当前目录，无需移动");await Ve({filePid:m.filePid,ids:o.join(",")}),F("move-success"),C.show=!1};function z(r){let v=r;O(r)||(v=[r]),o=v.map(y=>y.id),m={filePid:"0"},R=[...new Set(v.map(y=>y.filePid))],C.show=!0,te(()=>{T.value.init()})}return S({show:z}),(r,v)=>{const y=k("el-scrollbar");return a(),p("div",null,[l(we,{show:C.show,title:C.title,buttons:C.buttons,"show-cancel":!0,width:"720px",onClose:v[0]||(v[0]=w=>C.show=!1),padding:0,paddinglr:0},{default:s(()=>[e("div",tt,[e("div",lt,[l(ne,{ref_key:"navigationRef",ref:T,"watch-path":!1,onNavChange:n},null,512)]),e("div",ot,[l(y,{"view-style":"height:100%"},{default:s(()=>[b.value.length>0?(a(),p("div",st,[(a(!0),p(ee,null,me(b.value,w=>(a(),p("div",{class:"folder-item",onClick:f=>_(w)},[l(I,{"icon-name":"folder_2",width:40}),e("span",it,U(w.filename),1)],8,at))),256))])):(a(),p("div",nt,[l(I,{"icon-name":"folder_empty",width:90}),e("p",ct,"移动到"+U(i.value.filename)+"文件夹",1)]))]),_:1})])])]),_:1},8,["show","title","buttons"])])}}}),ut=ce(rt,[["__scopeId","data-v-8facdc29"]]),oe=h=>(he("data-v-425f0df5"),h=h(),ve(),h),_t={class:"share-container"},ft={style:{width:"400px"}},pt=oe(()=>e("br",null,null,-1)),mt={class:"share-success"},ht={class:"msg"},vt=oe(()=>e("span",{class:"text"},"成功创建分享链接，访问者无需提取码可直接查看分享文件",-1)),yt={class:"link"},wt=oe(()=>e("div",{class:"mask"},null,-1)),gt={class:"link-code"},bt=oe(()=>e("span",{class:"label"},"提取码",-1)),xt={class:"inline"},kt={class:"tip"},Ct={name:"ShareFile"},$t=Object.assign(Ct,{setup(h,{expose:S}){const F=[{label:"0",value:"1天"},{label:"1",value:"7天"},{label:"2",value:"30天"},{label:"3",value:"永久有效"}],{toClipboard:T}=Ie(),b=d(0),i=d({}),o=d(!1),R=d(),m=j({type:"info",msg:"仅支持数字及英文字母"}),C=d(document.location.origin+"/share/"),V=j({}),n=j({validType:"1",codType:"0",code:"",withCode:!1}),_=j({show:!1,title:"分享文件: ",showCancel:!0,buttons:[{type:"primary",text:"创建链接",isShow:!0,click:w=>{v()}},{type:"success",text:"复制链接及提取码",isShow:!1,click:w=>{y()}}]});function D(w){O(w)||(b.value=0,_.show=!0,te(()=>{R.value.resetFields(),b.value=0,_.buttons[0].isShow=!0,_.buttons[1].isShow=!1}),_.title="分享文件: "+w.filename,i.value=w)}function z(){m.type="info",m.value="仅支持数字及英文字母",n.code=""}function r(){/^[A-Za-z\d]{4}$/.test(n.code)?(m.type="info",m.value="仅支持数字及英文字母"):(m.type="error",m.value="仅可输入4位字母和数字")}const v=async()=>{o.value=!0;const w={fileId:i.value.id,validType:n.validType,code:n.code};try{const f=await Me(w);if(!f)return;Object.assign(V,f),b.value=1,_.buttons[0].isShow=!1,_.buttons[1].isShow=!0,o.value=!1}catch{}},y=async()=>{await T(`链接: ${C.value}${V.id} 提取码: ${V.code}`),X.success("复制成功")};return S({show:D}),(w,f)=>{const E=k("el-radio"),Y=k("el-radio-group"),J=k("el-form-item"),K=k("el-input"),Z=k("el-checkbox"),L=k("el-icon"),se=k("el-tooltip"),G=k("el-form"),ae=be("loading");return a(),W(we,{show:_.show,title:_.title,buttons:_.buttons,"show-cancel":!0,width:"600px",onClose:f[4]||(f[4]=g=>_.show=!1)},{default:s(()=>[M((a(),p("div",_t,[M(l(G,{model:n,ref_key:"shareFormRef",ref:R},{default:s(()=>[l(J,{label:"有效期"},{default:s(()=>[l(Y,{modelValue:n.validType,"onUpdate:modelValue":f[0]||(f[0]=g=>n.validType=g)},{default:s(()=>[(a(),p(ee,null,me(F,g=>l(E,{label:g.label},{default:s(()=>[P(U(g.value),1)]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"])]),_:1}),l(J,{label:"提取码"},{default:s(()=>[e("div",ft,[l(Y,{modelValue:n.codType,"onUpdate:modelValue":f[2]||(f[2]=g=>n.codType=g),onChange:z},{default:s(()=>[l(E,{label:"0"},{default:s(()=>[P("系统随机生成验证码")]),_:1}),l(E,{label:"1",style:{"margin-top":"10px"}},{default:s(()=>[l(K,{modelValue:n.code,"onUpdate:modelValue":f[1]||(f[1]=g=>n.code=g),placeholder:"请输入4位提取码",disabled:n.codType!=="1",style:{width:"160px"},onChange:r},null,8,["modelValue","disabled"]),e("span",{class:xe(["tips",m.type])},U(m.msg),3)]),_:1})]),_:1},8,["modelValue"]),e("div",null,[l(Z,{modelValue:n.withCode,"onUpdate:modelValue":f[3]||(f[3]=g=>n.withCode=g),label:"分享链接自动填充提取码",size:"large"},null,8,["modelValue"]),l(se,{effect:"dark",content:"",placement:"right"},{content:s(()=>[P(" 开启后分享链接会带上提取码，"),pt,P(" 用户点击链接可自动填充提取码 ")]),default:s(()=>[l(L,{style:{"margin-left":"6px"}},{default:s(()=>[l($(Ke))]),_:1})]),_:1})])])]),_:1})]),_:1},8,["model"]),[[B,b.value==0]]),M(e("div",mt,[e("div",ht,[l(L,{size:"16"},{default:s(()=>[l($(Ne))]),_:1}),vt]),e("div",yt,[l(K,{value:C.value+V.id,readonly:""},null,8,["value"]),wt]),e("div",gt,[bt,e("div",xt,[l(K,{value:V.code,readonly:""},null,8,["value"])])]),e("div",kt,[P(" 链接"),e("span",null,U(F[n.validType].value),1),n.validType!=3?(a(),p(ee,{key:0},[P("后失效")],64)):ie("",!0)])],512),[[B,b.value==1]])])),[[ae,o.value]])]),_:1},8,["show","title","buttons"])}}}),Ft=ce($t,[["__scopeId","data-v-425f0df5"]]),St=({shareFile:h,downloadFile:S,deleteFile:F,renameFile:T,copyFile:b,moveFile:i})=>[{title:"分享",label:"share",icon:"share",onClick:o=>{h(o)}},{title:"下载",label:"download",icon:"download",isShow:o=>!O(o)||O(o)&&o.filter(R=>R.folderType===1).length===0,onClick:o=>{S(o)}},{title:"删除",label:"delete",icon:"delete",onClick:o=>{F(o)}},{title:"重命名",label:"rename",icon:"rename",onClick:o=>{T(o)},isShow:o=>!O(o)||O(o)&&o.length==1},{title:"复制",label:"copy",icon:"copy",onClick:o=>{b(o)}},{title:"移动",label:"move",icon:"move",onClick:o=>{i(o)}}];const de=h=>(he("data-v-3b4a0de9"),h=h(),ve(),h),Rt={class:"main"},Vt={class:"main-header"},Tt={class:"toolbar"},zt={class:"toolbar-action"},Et={class:"toolbar-group"},At={class:"toolbar-group-item"},Pt={class:"action-main"},It={class:"toolbar-group-item"},Mt={class:"action-list"},Ot={class:"toolbar-group-item"},Ut={class:"toolbar-customize"},Dt={class:"search"},Nt={class:"main-body"},Ht={class:"nav"},Bt={class:"nav-list"},Lt={class:"nav-left"},jt={class:"file-list overflow-visible"},Kt={class:"file-item"},qt={key:2,class:"file-name"},Wt=["onClick"],Yt={class:"edit-action is-confirm"},Jt=["onClick"],Zt={class:"edit-action is-cancel"},Gt=["onClick"],Qt={class:"file-size"},Xt={key:0},el={key:1},tl={class:"table-empty"},ll={class:"main-empty"},ol={class:"u-empty"},sl={class:"empty-image"},al=de(()=>e("div",{class:"empty-description"},[e("span",{class:"text"},"当前列表为空，上传你的第一个文件吧")],-1)),il={class:"empty-bottom"},nl={class:"empty-action"},cl={class:"action-item"},dl={class:"action-item-image"},rl=de(()=>e("div",{class:"action-item-text"},"上传文件",-1)),ul={class:"action-item-image"},_l=de(()=>e("div",{class:"action-item-text"},"新建文件夹",-1)),fl={name:"Main",components:{Preview:ye}},pl=Object.assign(fl,{emits:["addFile"],setup(h,{expose:S,emit:F}){const T=[{label:"文件名",prop:"filename",scopedSlots:"filename",ellipsis:!0,minWidth:"40%"},{label:"修改时间",prop:"updateTime",minWidth:"25%",scopedSlots:"RowAction"},{label:"大小",prop:"fileSize",scopedSlots:"fileSize",minWidth:"23%"}],{fileUrlMap:b}=Ce,i=d(),o=d(),R=d(),m=d(),C=d(),V=d(),n=d(),_=d(!1),D=d(),z=d([]),r=d({id:"0"}),v=d(T),y=j({page:1,pageSize:20,filePid:"0",category:"all"}),w=St({deleteFile:t=>{C.value.show(t)},renameFile:t=>{ae(t)},moveFile:t=>{V.value.show(t)},downloadFile:async t=>{ge(t)},shareFile:t=>{n.value.show(t)}}),f=ke(()=>{const t=et[y.category];return t?t.accept:"*"});function E(){var t;(t=i.value)==null||t.reload()}function Y(t){const{category:c,curFolder:x}=t;y.category=c,y.filePid=x.id,r.value=x,E()}const J=async t=>{const c={...t,...y};c.category!=="all"&&delete c.filePid;try{return ze(c)}catch{return[]}},K=t=>{t.length>0?v.value[0].label=`已选中${t.length}个文件/文件夹`:v.value[0].label="文件名",z.value=t},Z=t=>{F("addFile",{file:t.file,filePid:r.value.id})},L=()=>{y.filename=D.value,E()},se=t=>{if(t.folderType==1){R.value.openFolder(t);return}if(t.status!=2){X.warning("文件未完成转码，无法预览");return}m.value.showPreview(t,0)},G=()=>{_.value||(i.value.setRowFieldValue("showEdit",!1),_.value=!0,i.value.unshiftRow({showEdit:!0,folderType:1,id:"",filePid:r.value.id,filenameReal:"",updateTime:Se("YY-mm-dd HH:MM",new Date)}),te(()=>{o.value.focus()}))},ae=t=>{var c,x;O(t)||(i.value.tableElRef.data[0].id==""&&i.value.tableElRef.data.splice(0,1),i.value.setRowFieldValue("showEdit",!1),t.showEdit=!0,_.value=!0,t.folderType==0?(t.filenameReal=(c=t.filename)==null?void 0:c.substring(0,t.filename.lastIndexOf(".")),t.fileSuffix=(x=t.filename)==null?void 0:x.substring(t.filename.lastIndexOf("."))):(t.filenameReal=t.filename,t.fileSuffix=""),te(()=>{o.value=!0}))},g=t=>{const c=i.value.tableElRef.data[t];c.id?c.showEdit=!1:i.value.tableElRef.data.splice(t,1),_.value=!1},re=async t=>{i.value.setLoading(!0);const{id:c,filePid:x,folderType:Q,filenameReal:N}=i.value.tableElRef.data[t];if(N==""||N.indexOf("/")!=-1){X.warning(`文件${Q==1?"夹":""}名不能为空，且不能含有 '/'`);return}if(c=="")try{const H=await Ee({filePid:x,filename:N});i.value.setRowValue(H,0)}catch{g(0)}else try{const H=await Ae({id:c,filename:N});i.value.setRowValue(H,t)}catch{g(0)}_.value=!1,i.value.setLoading(!1)},ge=async t=>{if(O(t))return;const c=b[0].createDownloadUrl+"/"+t.id,x=await Pe(c);x&&(window.location.href=b[0].downloadUrl+"/"+x.code)};return S({reloadTable:E}),(t,c)=>{const x=k("el-icon"),Q=k("el-button"),N=k("el-upload"),H=k("el-button-group"),ue=k("el-input");return a(),p("div",Rt,[e("div",Vt,[e("div",Tt,[e("div",zt,[e("div",Et,[M(e("div",At,[e("div",Pt,[l(N,{"show-file-list":!1,"with-credentials":!0,multiple:!0,"http-request":Z,accept:f.value},{default:s(()=>[l(Q,{type:"primary",round:"",style:{padding:"8px 24px"}},{default:s(()=>[l(x,{size:"16"},{default:s(()=>[l($(Xe))]),_:1}),P(" 上传")]),_:1})]),_:1},8,["accept"])])],512),[[B,z.value.length==0]]),M(e("div",It,[e("div",Mt,[l(H,null,{default:s(()=>[M(l(Q,{text:"",round:"",type:"primary",bg:"",onClick:G},{default:s(()=>[l(x,{size:"16"},{default:s(()=>[l($(Je))]),_:1}),P("新建文件夹 ")]),_:1},512),[[B,y.category=="all"]])]),_:1})])],512),[[B,z.value.length==0]]),M(e("div",Ot,[l($(pe),{value:z.value,actions:$(w)},null,8,["value","actions"])],512),[[B,z.value.length>0]])])]),e("div",Ut,[e("div",Dt,[l(ue,{modelValue:D.value,"onUpdate:modelValue":c[0]||(c[0]=A=>D.value=A),size:"small",clearable:"",placeholder:"搜索我的文件","input-style":"height: 32px",onKeyup:_e(L,["enter"]),onClear:L},{suffix:s(()=>[e("span",{class:"text",onClick:L},"搜索")]),_:1},8,["modelValue","onKeyup"])])])])]),e("div",Nt,[e("div",Ht,[e("div",Bt,[e("div",Lt,[l(ne,{ref_key:"navigationRef",ref:R,onNavChange:Y},null,512)])])]),e("div",jt,[l($($e),{ref_key:"dataTableRef",ref:i,columns:v.value,"row-key":A=>A.id,request:J,loading:!0,onSelectChange:K},{filename:s(({index:A,row:u})=>[e("div",Kt,[(u.fileType==3||u.fileType==1)&&u.status==2?(a(),W(I,{key:0,cover:u.fileCover,width:32},null,8,["cover"])):(a(),p(ee,{key:1},[u.folderType==0?(a(),W(I,{key:0,"file-type":u.fileType},null,8,["file-type"])):(a(),W(I,{key:1,"file-type":0}))],64)),u.showEdit?ie("",!0):(a(),p("span",qt,[e("span",{class:"text",onClick:fe(q=>se(u),["stop"])},U(u.filename),9,Wt)])),u.showEdit?(a(),p("div",{key:3,class:"edit-panel",onClick:c[1]||(c[1]=fe(()=>{},["stop"]))},[l(ue,{modelValue:u.filenameReal,"onUpdate:modelValue":q=>u.filenameReal=q,modelModifiers:{trim:!0},ref_key:"editNameRef",ref:o,size:"small",maxLength:190,onKeyup:_e(q=>re(A),["enter"])},{suffix:s(()=>[P(U(u.fileSuffix),1)]),_:2},1032,["modelValue","onUpdate:modelValue","onKeyup"]),e("div",Yt,[e("span",{class:"iconfont icon-check",onClick:q=>re(A)},null,8,Jt)]),e("div",Zt,[e("span",{class:"iconfont icon-close",onClick:q=>g(A)},null,8,Gt)])])):ie("",!0)])]),RowAction:s(({index:A,row:u})=>[(a(),W($(pe),{mode:"row",value:u,field:"updateTime",key:u.showEdit,actions:$(w),offset:-130},null,8,["value","actions"]))]),fileSize:s(({index:A,row:u})=>[e("div",Qt,[u.fileSize?(a(),p("span",Xt,U($(Fe)(u.fileSize)),1)):(a(),p("span",el," - "))])]),empty:s(()=>[e("div",tl,[e("div",ll,[e("div",ol,[e("div",sl,[l(I,{"icon-name":"empty",width:120,height:"auto"})]),al,e("div",il,[e("div",nl,[l(N,{"show-file-list":!1,"with-credentials":!0,multiple:!0,"http-request":Z,accept:f.value},{default:s(()=>[e("div",cl,[e("div",dl,[l(I,{"icon-name":"empty_upload",width:42})]),rl])]),_:1},8,["accept"]),M(e("div",{class:"action-item",onClick:G},[e("div",ul,[l(I,{"icon-name":"empty_newFolder",width:42})]),_l],512),[[B,y.category=="all"]])])])])])])]),_:1},8,["columns","row-key"])])]),l(ye,{ref_key:"previewRef",ref:m},null,512),l($(Re),{ref_key:"deleteFileRef",ref:C,onDeleteSuccess:E},null,512),l($(ut),{ref_key:"moveFileRef",ref:V,onMoveSuccess:E},null,512),l($(Ft),{ref_key:"shareFileRef",ref:n},null,512)])}}}),Fl=ce(pl,[["__scopeId","data-v-3b4a0de9"]]);export{Fl as default};
