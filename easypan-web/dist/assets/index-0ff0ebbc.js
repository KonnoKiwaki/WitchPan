import{d as re,o as v,c as g,a as r,_ as G,e as k,g as ie,h as V,A as L,t as B,i as f,w as S,F as O,r as H,k as Z,l as T,B as D,C as j,y as ee,z as te,D as _e,b as ce,u as ve,G as W,H as me,j as M,I as X,J as ge,K as ye,L as we,m as K,f as Y,q as ue,V as be,v as de,M as Se,N,O as xe,E as $e,x as Q,Q as Ce,R as Ae,S as ke}from"./index-cd067b4e.js";import{g as Ue,u as Fe,b as Ve,L as ne,c as Ie}from"./user-7ab5ada6.js";const Me={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},Be=r("path",{d:"M847.9 592H152c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h605.2L612.9 851c-4.1 5.2-.4 13 6.3 13h72.5c4.9 0 9.5-2.2 12.6-6.1l168.8-214.1c16.5-21 1.6-51.8-25.2-51.8zM872 356H266.8l144.3-183c4.1-5.2.4-13-6.3-13h-72.5c-4.9 0-9.5 2.2-12.6 6.1L150.9 380.2c-16.5 21-1.6 51.8 25.1 51.8h696c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z",fill:"currentColor"},null,-1),ze=[Be],Pe=re({name:"SwapOutlined",render:function(F,w){return v(),g("svg",Me,ze)}}),Re={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},De=r("path",{d:"M168 504.2c1-43.7 10-86.1 26.9-126c17.3-41 42.1-77.7 73.7-109.4S337 212.3 378 195c42.4-17.9 87.4-27 133.9-27s91.5 9.1 133.8 27A341.5 341.5 0 0 1 755 268.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 0 0 3 14.1l175.7 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c0-6.7-7.7-10.5-12.9-6.3l-56.4 44.1C765.8 155.1 646.2 92 511.8 92C282.7 92 96.3 275.6 92 503.8a8 8 0 0 0 8 8.2h60c4.4 0 7.9-3.5 8-7.8zm756 7.8h-60c-4.4 0-7.9 3.5-8 7.8c-1 43.7-10 86.1-26.9 126c-17.3 41-42.1 77.8-73.7 109.4A342.45 342.45 0 0 1 512.1 856a342.24 342.24 0 0 1-243.2-100.8c-9.9-9.9-19.2-20.4-27.8-31.4l60.2-47a8 8 0 0 0-3-14.1l-175.7-43c-5-1.2-9.9 2.6-9.9 7.7l-.7 181c0 6.7 7.7 10.5 12.9 6.3l56.4-44.1C258.2 868.9 377.8 932 512.2 932c229.2 0 415.5-183.7 419.8-411.8a8 8 0 0 0-8-8.2z",fill:"currentColor"},null,-1),je=[De],Le=re({name:"SyncOutlined",render:function(F,w){return v(),g("svg",Re,je)}});const Oe=d=>(ee("data-v-dd0b32d4"),d=d(),te(),d),Ee={class:"expand-menu"},Ne={class:"text"},Te={class:"edit"},qe=Oe(()=>r("i",{class:"iconfont icon-cate-edit"},null,-1)),Ke={class:"expand-menu-list"},He=["onClick"],Ge={class:"body"},Je={class:"text"},Qe={name:"ExpandMenu"},We=Object.assign(Qe,{props:{modelValue:{type:Array},title:{type:String},activePath:{type:String}},setup(d,{emit:F}){const w=d,u=k(w.modelValue),i=k(!0),c=k([]);ie(()=>{c.value=w.modelValue.map(_=>{if(_.isShow==null||_.isShow)return _.name})});function h(_){const p=w.modelValue.filter(x=>_.includes(x.name));u.value=p}function y(){w.modelValue&&w.modelValue.length>0&&b(w.modelValue[0])}function b(_){F("item-click",{path:_.path,key:_.name})}return(_,p)=>{const x=V("el-checkbox"),A=V("el-checkbox-group"),R=V("el-popover");return v(),g("div",Ee,[r("div",{class:L(["expand-menu-title",d.activePath==d.modelValue[0].path?"active":""]),onClick:y},[r("i",{class:L(["iconfont icon-arrow-down animation",i.value?"":"rotate"]),onClick:p[0]||(p[0]=()=>i.value=!i.value)},null,2),r("span",Ne,B(d.title),1),r("div",Te,[f(R,{placement:"right-start",trigger:"click","show-arrow":!1,"popper-style":"padding: 14px 0px; width: 120px; min-width:120px;border-radius:8px"},{reference:S(()=>[qe]),default:S(()=>[f(A,{modelValue:c.value,"onUpdate:modelValue":p[1]||(p[1]=m=>c.value=m),onChange:h},{default:S(()=>[(v(!0),g(O,null,H(d.modelValue,m=>(v(),g(O,null,[m.isShow==null||m.isShow?(v(),Z(x,{key:0,size:"large",class:"check-item",label:m.name},null,8,["label"])):T("",!0)],64))),256))]),_:1},8,["modelValue"])]),_:1})])],2),D(r("div",Ke,[(v(!0),g(O,null,H(u.value,m=>(v(),g(O,null,[m.isShow==null||m.isShow?(v(),g("div",{key:0,class:L(["expand-menu-item",m.path==d.activePath?"active":""]),onClick:z=>b(m)},[r("div",Ge,[m.icon?(v(),g("span",{key:0,class:L(["iconfont","icon-"+m.icon])},null,2)):T("",!0),r("span",Je,B(m.name),1)])],10,He)):T("",!0)],64))),256))],512),[[j,i.value]])])}}}),Xe=G(We,[["__scopeId","data-v-dd0b32d4"]]),oe=60*60*24*7,Ye=({prefixKey:d="",storage:F=localStorage}={})=>{function w(){this.storage=F,this.prefixKey=d,this.getKey=function(u){return`${this.prefixKey}${u}`.toUpperCase()},this.set=function(u,i,c=oe){const h=JSON.stringify({value:i,expire:c!=null?new Date().getTime()+c*1e3:null});this.storage.setItem(this.getKey(u),h)},this.get=function(u,i=null){const c=this.storage.getItem(this.getKey(u));if(c)try{const h=JSON.parse(c),{value:y,expire:b}=h;if(b===null||b>=Date.now())return y;this.remove(u)}catch{return i}return i},this.remove=function(u){this.storage.removeItem(this.getKey(u))},this.clear=function(){this.storage.clear()},this.setCookie=function(u,i,c=oe){document.cookie=`${this.getKey(u)}=${i}; Max-Age=${c}`},this.getCookie=function(u){const i=document.cookie.split("; ");for(let c=0,h=i.length;c<h;c++){const y=i[c].split("=");if(y[0]===this.getKey(u))return y[1]}return""},this.removeCookie=function(u){this.setCookie(u,1,-1)},this.clearCookie=function(){const u=document.cookie.match(/[^ =;]+(?==)/g);if(u)for(let i=u.length;i--;)document.cookie=u[i]+"=0;expire="+new Date(0).toUTCString()}}return new w},ae=Ye(),le="USER_SPACE",pe=_e({id:"app-user",state:()=>({userSpace:ae.get(le,{useSpace:0,totalSpace:1})}),getters:{getUserSapce(){return this.userSpace}},actions:{setUserSapce(d){this.userSpace=d},async fetchUserSpace(){try{const d=await Ue(),F=7*24*60*60;return ae.set(le,d,F),this.setUserSapce(d),Promise.resolve(d)}catch(d){return Promise.reject(d)}}}});const Ze={class:"menu"},et={class:"menu-list"},tt=["onClick"],st={key:1,class:"item-img"},nt=["src"],ot=["src"],at={class:"text"},lt={class:"menu-sub-list"},rt={key:0},it=["onClick"],ct={class:"body"},ut={class:"text"},dt={key:0,class:"tips"},pt={class:"space-info"},ft={class:"percent"},ht={class:"space-use"},_t={class:"use"},vt={name:"Menu"},mt=Object.assign(vt,{setup(d){const F=ce(),w=ve(),u=pe(),i=k([]),c=k({}),h=k(),y=W(()=>(u==null?void 0:u.userSpace)||{useSpace:0,totalSpace:1}),b=W(()=>Math.floor(y.value.useSpace/y.value.totalSpace*1e4)/100);function _(A){!A.path||A.key==c.value.key||F.push(A.path)}function p(A){i.value.length===0&&(i.value=ge(ye));const R=A.substring(0,A.lastIndexOf("/")),m=i.value.find(z=>z.path===R);c.value=m||{},h.value=A}const x=async()=>{await u.fetchUserSpace()};return me(()=>{p(w.path)}),ie(()=>{x()}),(A,R)=>{const m=V("el-progress"),z=V("el-icon");return v(),g("div",Ze,[r("div",et,[(v(!0),g(O,null,H(i.value,l=>(v(),g("div",{class:L(["menu-item",l.key===c.value.key?"active":""]),onClick:a=>_(l)},[l.icon?(v(),g("div",{key:0,class:L(["iconfont","icon-"+l.icon])},null,2)):l.src?(v(),g("div",st,[D(r("img",{src:l.src[0],alt:""},null,8,nt),[[j,l.key===c.value.key]]),D(r("img",{src:l.src[1],alt:""},null,8,ot),[[j,l.key!==c.value.key]])])):T("",!0),r("div",at,B(l.label),1)],10,tt))),256))]),r("div",lt,[(v(!0),g(O,null,H(c.value.children,l=>(v(),g(O,null,[l.meta&&l.meta.children?(v(),g("div",rt,[f(Xe,{title:l.label,modelValue:l.meta.children,"onUpdate:modelValue":a=>l.meta.children=a,activePath:h.value,onItemClick:_},null,8,["title","modelValue","onUpdate:modelValue","activePath"])])):l?(v(),g("div",{key:1,class:L(["menu-sub-item",l.path==h.value?"active":""]),onClick:a=>_(l)},[r("div",ct,[r("span",ut,B(l.label),1)])],10,it)):T("",!0)],64))),256)),c.value&&c.value.tips?(v(),g("div",dt,B(c.value.tips),1)):T("",!0),r("div",pt,[r("div",ft,[f(m,{percentage:b.value,"show-text":!1,color:"#ffd821"},null,8,["percentage"])]),r("div",ht,[r("div",_t,B(M(X)(y.value.useSpace))+" / "+B(M(X)(y.value.totalSpace)),1),f(z,{class:"refresh",size:14,onClick:x},{default:S(()=>[f(M(Le))]),_:1})])])])])}}}),gt=G(mt,[["__scopeId","data-v-a592c8de"]]);const yt={class:"avatar-upload"},wt={class:"avatar-show"},bt=["src"],St=["src"],xt=["src"],$t={class:"select-btn"},Ct={name:"AvatarUpload"},At=Object.assign(Ct,{props:{modelValue:{type:Object,default:null}},setup(d,{emit:F}){we();const w=k(new Date),u=k(null),i=async c=>{c=c.file;let h=new FileReader;h.readAsDataURL(c),h.onload=({target:y})=>{u.value=y.result},F("update:modelValue",c)};return(c,h)=>{const y=V("el-button"),b=V("el-upload");return v(),g("div",yt,[r("div",wt,[u.value?(v(),g("img",{key:0,src:u.value},null,8,bt)):(v(),g(O,{key:1},[d.modelValue&&d.modelValue.qqAvatar?(v(),g("img",{key:0,src:`${d.modelValue.qqAvatar}`},null,8,St)):(v(),g("img",{key:1,src:`/api/getAvatar/${d.modelValue.userId}?${w.value}`},null,8,xt))],64))]),r("div",$t,[f(b,{name:"file","show-file-list":!1,accept:".png,.PNG,.jpg,.JPG,.jpeg,.gif,.GIF,.bmp,.MP",multiple:!1,"http-request":i},{default:S(()=>[f(y,{type:"primary"},{default:S(()=>[K("选择")]),_:1})]),_:1})])])}}}),kt={name:"UploadAvatar"},Ut=Object.assign(kt,{setup(d,{expose:F,emit:w}){const u=Y({show:!1,title:"修改头像",buttons:[{type:"primary",text:"确定",click:b=>{y()}}]}),i=k(),c=k({});F({show:b=>{c.value=Object.assign({},b),c.value.avatar={userId:b.id,qqAvatar:b.avatar},u.show=!0}});const y=async()=>{if(!(c.value.avatar instanceof File)){u.show=!1;return}const b=new FormData;b.append("avatar",c.value.avatar),await Fe(b),u.show=!1,w("upload-success")};return(b,_)=>{const p=V("el-form-item"),x=V("el-form");return v(),Z(ue,{show:u.show,title:u.title,buttons:u.buttons,width:"500px",showCancel:!1,onClose:_[1]||(_[1]=A=>u.show=!1)},{default:S(()=>[f(x,{ref_key:"formDataRef",ref:i,model:c.value,"label-width":"80px"},{default:S(()=>[f(p,{label:"昵称"},{default:S(()=>[K(B(c.value.nickname),1)]),_:1}),f(p,{label:"头像上传"},{default:S(()=>[f(At,{modelValue:c.value.avatar,"onUpdate:modelValue":_[0]||(_[0]=A=>c.value.avatar=A)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title","buttons"])}}}),Ft={name:"UploadPassword"},Vt=Object.assign(Ft,{setup(d,{expose:F}){const w=(_,p,x)=>{p!==i.value.password?x(new Error(_.message)):x()},u=Y({password:[{required:!0,message:"请输入密码",trigger:"blur"},{validator:be.password,message:"密码只能是数字, 字母, 特殊字符8-18位",trigger:"blur"}],rePassword:[{required:!0,message:"请再次输入密码",trigger:"blur"},{validator:w,message:"两次密码不一致",trigger:"blur"}]}),i=k({}),c=k(),h=Y({show:!1,title:"修改密码",buttons:[{type:"primary",text:"确定",click:_=>{b()}}]});F({show:()=>{h.show=!0,de(()=>{c.value.resetFields(),i.value={}})}});const b=()=>{c.value.validate(async _=>{_&&(await Ve({password:i.value.password}),h.show=!1)})};return(_,p)=>{const x=V("el-input"),A=V("el-form-item"),R=V("el-form");return v(),g("div",null,[f(ue,{show:h.show,title:h.title,buttons:h.buttons,width:"400px",showCancel:!1,onClose:p[2]||(p[2]=m=>h.show=!1)},{default:S(()=>[f(R,{ref_key:"formDataRef",ref:c,model:i.value,"label-width":"80px",rules:u},{default:S(()=>[f(A,{label:"新密码",prop:"password"},{default:S(()=>[f(x,{"show-password":"",type:"password",placeholder:"请输入密码",modelValue:i.value.password,"onUpdate:modelValue":p[0]||(p[0]=m=>i.value.password=m),modelModifiers:{trim:!0},"prefix-icon":M(ne),maxLength:"20"},null,8,["modelValue","prefix-icon"])]),_:1}),f(A,{label:"确认密码",prop:"rePassword"},{default:S(()=>[f(x,{"show-password":"",type:"password",placeholder:"请再次输入密码",modelValue:i.value.rePassword,"onUpdate:modelValue":p[1]||(p[1]=m=>i.value.rePassword=m),modelModifiers:{trim:!0},"prefix-icon":M(ne),maxLength:"20"},null,8,["modelValue","prefix-icon"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["show","title","buttons"])])}}}),U={empty:{value:"empty",desc:"文件为空",color:"#F75000",icon:"close"},fail:{value:"fail",desc:"上传失败",color:"#F75000",icon:"close"},init:{value:"init",desc:"解析中",color:"#e6a23c",icon:"clock"},uploading:{value:"uploading",desc:"上传中",color:"#409eff",icon:"upload"},upload_finish:{value:"upload_finish",desc:"上传完成",color:"#67c23a",icon:"ok"},upload_seconds:{value:"upload_seconds",desc:"秒传",color:"#67c23a",icon:"ok"}};var fe={exports:{}};(function(d,F){(function(w){d.exports=w()})(function(w){var u=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function i(a,o){var e=a[0],t=a[1],n=a[2],s=a[3];e+=(t&n|~t&s)+o[0]-680876936|0,e=(e<<7|e>>>25)+t|0,s+=(e&t|~e&n)+o[1]-389564586|0,s=(s<<12|s>>>20)+e|0,n+=(s&e|~s&t)+o[2]+606105819|0,n=(n<<17|n>>>15)+s|0,t+=(n&s|~n&e)+o[3]-1044525330|0,t=(t<<22|t>>>10)+n|0,e+=(t&n|~t&s)+o[4]-176418897|0,e=(e<<7|e>>>25)+t|0,s+=(e&t|~e&n)+o[5]+1200080426|0,s=(s<<12|s>>>20)+e|0,n+=(s&e|~s&t)+o[6]-1473231341|0,n=(n<<17|n>>>15)+s|0,t+=(n&s|~n&e)+o[7]-45705983|0,t=(t<<22|t>>>10)+n|0,e+=(t&n|~t&s)+o[8]+1770035416|0,e=(e<<7|e>>>25)+t|0,s+=(e&t|~e&n)+o[9]-1958414417|0,s=(s<<12|s>>>20)+e|0,n+=(s&e|~s&t)+o[10]-42063|0,n=(n<<17|n>>>15)+s|0,t+=(n&s|~n&e)+o[11]-1990404162|0,t=(t<<22|t>>>10)+n|0,e+=(t&n|~t&s)+o[12]+1804603682|0,e=(e<<7|e>>>25)+t|0,s+=(e&t|~e&n)+o[13]-40341101|0,s=(s<<12|s>>>20)+e|0,n+=(s&e|~s&t)+o[14]-1502002290|0,n=(n<<17|n>>>15)+s|0,t+=(n&s|~n&e)+o[15]+1236535329|0,t=(t<<22|t>>>10)+n|0,e+=(t&s|n&~s)+o[1]-165796510|0,e=(e<<5|e>>>27)+t|0,s+=(e&n|t&~n)+o[6]-1069501632|0,s=(s<<9|s>>>23)+e|0,n+=(s&t|e&~t)+o[11]+643717713|0,n=(n<<14|n>>>18)+s|0,t+=(n&e|s&~e)+o[0]-373897302|0,t=(t<<20|t>>>12)+n|0,e+=(t&s|n&~s)+o[5]-701558691|0,e=(e<<5|e>>>27)+t|0,s+=(e&n|t&~n)+o[10]+38016083|0,s=(s<<9|s>>>23)+e|0,n+=(s&t|e&~t)+o[15]-660478335|0,n=(n<<14|n>>>18)+s|0,t+=(n&e|s&~e)+o[4]-405537848|0,t=(t<<20|t>>>12)+n|0,e+=(t&s|n&~s)+o[9]+568446438|0,e=(e<<5|e>>>27)+t|0,s+=(e&n|t&~n)+o[14]-1019803690|0,s=(s<<9|s>>>23)+e|0,n+=(s&t|e&~t)+o[3]-187363961|0,n=(n<<14|n>>>18)+s|0,t+=(n&e|s&~e)+o[8]+1163531501|0,t=(t<<20|t>>>12)+n|0,e+=(t&s|n&~s)+o[13]-1444681467|0,e=(e<<5|e>>>27)+t|0,s+=(e&n|t&~n)+o[2]-51403784|0,s=(s<<9|s>>>23)+e|0,n+=(s&t|e&~t)+o[7]+1735328473|0,n=(n<<14|n>>>18)+s|0,t+=(n&e|s&~e)+o[12]-1926607734|0,t=(t<<20|t>>>12)+n|0,e+=(t^n^s)+o[5]-378558|0,e=(e<<4|e>>>28)+t|0,s+=(e^t^n)+o[8]-2022574463|0,s=(s<<11|s>>>21)+e|0,n+=(s^e^t)+o[11]+1839030562|0,n=(n<<16|n>>>16)+s|0,t+=(n^s^e)+o[14]-35309556|0,t=(t<<23|t>>>9)+n|0,e+=(t^n^s)+o[1]-1530992060|0,e=(e<<4|e>>>28)+t|0,s+=(e^t^n)+o[4]+1272893353|0,s=(s<<11|s>>>21)+e|0,n+=(s^e^t)+o[7]-155497632|0,n=(n<<16|n>>>16)+s|0,t+=(n^s^e)+o[10]-1094730640|0,t=(t<<23|t>>>9)+n|0,e+=(t^n^s)+o[13]+681279174|0,e=(e<<4|e>>>28)+t|0,s+=(e^t^n)+o[0]-358537222|0,s=(s<<11|s>>>21)+e|0,n+=(s^e^t)+o[3]-722521979|0,n=(n<<16|n>>>16)+s|0,t+=(n^s^e)+o[6]+76029189|0,t=(t<<23|t>>>9)+n|0,e+=(t^n^s)+o[9]-640364487|0,e=(e<<4|e>>>28)+t|0,s+=(e^t^n)+o[12]-421815835|0,s=(s<<11|s>>>21)+e|0,n+=(s^e^t)+o[15]+530742520|0,n=(n<<16|n>>>16)+s|0,t+=(n^s^e)+o[2]-995338651|0,t=(t<<23|t>>>9)+n|0,e+=(n^(t|~s))+o[0]-198630844|0,e=(e<<6|e>>>26)+t|0,s+=(t^(e|~n))+o[7]+1126891415|0,s=(s<<10|s>>>22)+e|0,n+=(e^(s|~t))+o[14]-1416354905|0,n=(n<<15|n>>>17)+s|0,t+=(s^(n|~e))+o[5]-57434055|0,t=(t<<21|t>>>11)+n|0,e+=(n^(t|~s))+o[12]+1700485571|0,e=(e<<6|e>>>26)+t|0,s+=(t^(e|~n))+o[3]-1894986606|0,s=(s<<10|s>>>22)+e|0,n+=(e^(s|~t))+o[10]-1051523|0,n=(n<<15|n>>>17)+s|0,t+=(s^(n|~e))+o[1]-2054922799|0,t=(t<<21|t>>>11)+n|0,e+=(n^(t|~s))+o[8]+1873313359|0,e=(e<<6|e>>>26)+t|0,s+=(t^(e|~n))+o[15]-30611744|0,s=(s<<10|s>>>22)+e|0,n+=(e^(s|~t))+o[6]-1560198380|0,n=(n<<15|n>>>17)+s|0,t+=(s^(n|~e))+o[13]+1309151649|0,t=(t<<21|t>>>11)+n|0,e+=(n^(t|~s))+o[4]-145523070|0,e=(e<<6|e>>>26)+t|0,s+=(t^(e|~n))+o[11]-1120210379|0,s=(s<<10|s>>>22)+e|0,n+=(e^(s|~t))+o[2]+718787259|0,n=(n<<15|n>>>17)+s|0,t+=(s^(n|~e))+o[9]-343485551|0,t=(t<<21|t>>>11)+n|0,a[0]=e+a[0]|0,a[1]=t+a[1]|0,a[2]=n+a[2]|0,a[3]=s+a[3]|0}function c(a){var o=[],e;for(e=0;e<64;e+=4)o[e>>2]=a.charCodeAt(e)+(a.charCodeAt(e+1)<<8)+(a.charCodeAt(e+2)<<16)+(a.charCodeAt(e+3)<<24);return o}function h(a){var o=[],e;for(e=0;e<64;e+=4)o[e>>2]=a[e]+(a[e+1]<<8)+(a[e+2]<<16)+(a[e+3]<<24);return o}function y(a){var o=a.length,e=[1732584193,-271733879,-1732584194,271733878],t,n,s,$,C,I;for(t=64;t<=o;t+=64)i(e,c(a.substring(t-64,t)));for(a=a.substring(t-64),n=a.length,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<n;t+=1)s[t>>2]|=a.charCodeAt(t)<<(t%4<<3);if(s[t>>2]|=128<<(t%4<<3),t>55)for(i(e,s),t=0;t<16;t+=1)s[t]=0;return $=o*8,$=$.toString(16).match(/(.*?)(.{0,8})$/),C=parseInt($[2],16),I=parseInt($[1],16)||0,s[14]=C,s[15]=I,i(e,s),e}function b(a){var o=a.length,e=[1732584193,-271733879,-1732584194,271733878],t,n,s,$,C,I;for(t=64;t<=o;t+=64)i(e,h(a.subarray(t-64,t)));for(a=t-64<o?a.subarray(t-64):new Uint8Array(0),n=a.length,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<n;t+=1)s[t>>2]|=a[t]<<(t%4<<3);if(s[t>>2]|=128<<(t%4<<3),t>55)for(i(e,s),t=0;t<16;t+=1)s[t]=0;return $=o*8,$=$.toString(16).match(/(.*?)(.{0,8})$/),C=parseInt($[2],16),I=parseInt($[1],16)||0,s[14]=C,s[15]=I,i(e,s),e}function _(a){var o="",e;for(e=0;e<4;e+=1)o+=u[a>>e*8+4&15]+u[a>>e*8&15];return o}function p(a){var o;for(o=0;o<a.length;o+=1)a[o]=_(a[o]);return a.join("")}p(y("hello")),typeof ArrayBuffer<"u"&&!ArrayBuffer.prototype.slice&&function(){function a(o,e){return o=o|0||0,o<0?Math.max(o+e,0):Math.min(o,e)}ArrayBuffer.prototype.slice=function(o,e){var t=this.byteLength,n=a(o,t),s=t,$,C,I,P;return e!==w&&(s=a(e,t)),n>s?new ArrayBuffer(0):($=s-n,C=new ArrayBuffer($),I=new Uint8Array(C),P=new Uint8Array(this,n,$),I.set(P),C)}}();function x(a){return/[\u0080-\uFFFF]/.test(a)&&(a=unescape(encodeURIComponent(a))),a}function A(a,o){var e=a.length,t=new ArrayBuffer(e),n=new Uint8Array(t),s;for(s=0;s<e;s+=1)n[s]=a.charCodeAt(s);return o?n:t}function R(a){return String.fromCharCode.apply(null,new Uint8Array(a))}function m(a,o,e){var t=new Uint8Array(a.byteLength+o.byteLength);return t.set(new Uint8Array(a)),t.set(new Uint8Array(o),a.byteLength),e?t:t.buffer}function z(a){var o=[],e=a.length,t;for(t=0;t<e-1;t+=2)o.push(parseInt(a.substr(t,2),16));return String.fromCharCode.apply(String,o)}function l(){this.reset()}return l.prototype.append=function(a){return this.appendBinary(x(a)),this},l.prototype.appendBinary=function(a){this._buff+=a,this._length+=a.length;var o=this._buff.length,e;for(e=64;e<=o;e+=64)i(this._hash,c(this._buff.substring(e-64,e)));return this._buff=this._buff.substring(e-64),this},l.prototype.end=function(a){var o=this._buff,e=o.length,t,n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],s;for(t=0;t<e;t+=1)n[t>>2]|=o.charCodeAt(t)<<(t%4<<3);return this._finish(n,e),s=p(this._hash),a&&(s=z(s)),this.reset(),s},l.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},l.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},l.prototype.setState=function(a){return this._buff=a.buff,this._length=a.length,this._hash=a.hash,this},l.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},l.prototype._finish=function(a,o){var e=o,t,n,s;if(a[e>>2]|=128<<(e%4<<3),e>55)for(i(this._hash,a),e=0;e<16;e+=1)a[e]=0;t=this._length*8,t=t.toString(16).match(/(.*?)(.{0,8})$/),n=parseInt(t[2],16),s=parseInt(t[1],16)||0,a[14]=n,a[15]=s,i(this._hash,a)},l.hash=function(a,o){return l.hashBinary(x(a),o)},l.hashBinary=function(a,o){var e=y(a),t=p(e);return o?z(t):t},l.ArrayBuffer=function(){this.reset()},l.ArrayBuffer.prototype.append=function(a){var o=m(this._buff.buffer,a,!0),e=o.length,t;for(this._length+=a.byteLength,t=64;t<=e;t+=64)i(this._hash,h(o.subarray(t-64,t)));return this._buff=t-64<e?new Uint8Array(o.buffer.slice(t-64)):new Uint8Array(0),this},l.ArrayBuffer.prototype.end=function(a){var o=this._buff,e=o.length,t=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],n,s;for(n=0;n<e;n+=1)t[n>>2]|=o[n]<<(n%4<<3);return this._finish(t,e),s=p(this._hash),a&&(s=z(s)),this.reset(),s},l.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},l.ArrayBuffer.prototype.getState=function(){var a=l.prototype.getState.call(this);return a.buff=R(a.buff),a},l.ArrayBuffer.prototype.setState=function(a){return a.buff=A(a.buff,!0),l.prototype.setState.call(this,a)},l.ArrayBuffer.prototype.destroy=l.prototype.destroy,l.ArrayBuffer.prototype._finish=l.prototype._finish,l.ArrayBuffer.hash=function(a,o){var e=b(new Uint8Array(a)),t=p(e);return o?z(t):t},l})})(fe);var It=fe.exports;const Mt=Se(It);const se=d=>(ee("data-v-11f9e00e"),d=d(),te(),d),Bt={class:"uploader-panel"},zt={class:"uploader-header"},Pt={class:"uploader-body"},Rt={class:"file-list"},Dt={class:"file-item"},jt={class:"file-info"},Lt=se(()=>r("div",{class:"file-icon"},[r("img",{src:"https://staticwx.cdn.bcebos.com/mini-program/images/ic_image_v2.png",alt:""})],-1)),Ot={class:"file-progress"},Et={class:"file-status"},Nt={class:"error"},Tt={class:"cursor-p"},qt={class:"file-size"},Kt=se(()=>r("span",{class:"speed"},null,-1)),Ht={class:"file-operate"},Gt={title:"所在文件夹",class:"common-icon-container"},Jt=["onClick"],Qt=["onClick"],Wt=["onClick"],Xt=["onClick"],Yt=se(()=>r("span",{class:"always-tips"},"- 仅展示本次上传任务 -",-1)),Zt={name:"FileUploader",components:{Icon:N}},es=Object.assign(Zt,{emits:["uploadCallback"],setup(d,{expose:F,emit:w}){const i=k([]),c=k([]),h=W(()=>i.value.filter(l=>l.status==U.upload_finish.value||l.status==U.upload_seconds.value).length);function y(l){return l==U.uploading.value||l==U.init.value}F({addFile:async(l,a)=>{const o={file:l,uid:l.uid,md5:null,filename:l.name,status:U.init.value,uploadSize:0,totalSize:l.size,progress:0,pause:!1,cancel:!1,chunkIndex:0,filePid:a,errorMsg:null};if(i.value.unshift(o),o.totalSize==0){o.status=U.empty.value;return}let e=await _(o);e!=null&&x(e)}});async function _(l){let a=l.file,o=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice,e=Math.ceil(a.size/5242880),t=0,n=new Mt.ArrayBuffer,s=new FileReader,$=()=>{let C=t*5242880,I=C+5242880>=a.size?a.size:5242880;s.readAsArrayBuffer(o.call(a,C,I))};return $(),new Promise((C,I)=>{let P=p(a.uid);P.status=U.init.value,s.onload=E=>{if(n.append(E.target.result),t++,t<e){let q=Math.floor(t/e*100);P.progress=q,$()}else{let q=n.end();n.destroy(),P.progress=100,P.md5=q,P.progress=0,P.status=U.uploading.value,C(l.uid)}},s.onerror=()=>{P.progress=-1,P.status=U.fail.value,C(l.uid)}}).catch(C=>(console.log(C),null))}const p=l=>i.value.find(o=>o.file.uid==l),x=async(l,a)=>{a=a||0;let o=p(l);const e=o.file,t=o.totalSize,n=Math.ceil(t/5242880);for(let s=a;s<n;s++){let $=c.value.indexOf(l);if($!=-1){c.value.splice($,1);break}if(o=p(l),o.pause||o.cancel)break;let C=s*5242880,I=C+5242880>=t?t:C+5242880,P=e.slice(C,I);try{let E=await xe({file:P,filename:e.name,fileMd5:o.md5,chunkIndex:s,chunks:n,id:o.id,filePid:o.filePid},{onUploadProgress:q=>{let J=q.loaded;J>t&&(J=t),o.uploadSize=s*5242880+J,o.progress=Math.floor(o.uploadSize/t*100)}});if(o.id=E.id,o.status=U[E.status].value,o.chunkIndex=s,E.status==U.upload_seconds.value||E.status==U.upload_finish.value){$e.success("文件上传成功～"),o.progress=100,w("uploadCallback");break}}catch(E){console.log(E),o.status=U.fail.value}}};function A(l){p(l).pause=!0}function R(l){const a=p(l);a.pause=!1,x(a.uid,a.chunkIndex+1)}function m(l){p(l).cancel=!0}function z(l){const a=p(l);a.cancel=!1,x(a.uid)}return(l,a)=>{const o=V("el-progress");return v(),g("div",Bt,[r("div",zt,[r("span",null,"上传完成（"+B(h.value)+"/"+B(i.value.length)+"）",1)]),r("div",Pt,[r("ul",Rt,[(v(!0),g(O,null,H(i.value,(e,t)=>(v(),g("li",Dt,[r("div",jt,[Lt,r("div",Ot,[r("div",{class:L(["name-text",!y(e.status)||e.cancel?"no-progress":""])},B(e.filename),3),D(f(o,{percentage:e.progress,"stroke-width":3,striped:"","show-text":!1,"striped-flow":"",duration:20},null,8,["percentage"]),[[j,y(e.status)&&!e.cancel]]),r("div",{class:L(["status",!y(e.status)||e.cancel?"no-progress":""])},[D(r("span",Et,[r("span",Nt,[r("span",Tt,B(M(U).init.desc),1)])],512),[[j,e==M(U).init.value]]),r("div",qt,B(M(X)(e.totalSize)),1),Kt],2)])]),r("div",Ht,[D(r("span",Gt,[f(N,{iconName:"open_folder","custom-class":"img",width:28})],512),[[j,e.status==M(U).upload_finish.value||e.status==M(U).upload_seconds.value]]),D(r("span",{title:"暂停",class:"common-icon-container",onClick:n=>A(e.uid)},[f(N,{iconName:"pause","custom-class":"img",width:28})],8,Jt),[[j,e.status==M(U).uploading.value&&!e.pause&&!e.cancel]]),D(r("span",{title:"继续上传",class:"common-icon-container",onClick:n=>R(e.uid)},[f(N,{iconName:"reupload","custom-class":"img",width:28})],8,Qt),[[j,e.status==M(U).uploading.value&&e.pause]]),D(r("span",{title:"重试",class:"common-icon-container",onClick:n=>z(e.uid)},[f(N,{iconName:"retry","custom-class":"img",width:28})],8,Wt),[[j,e.cancel]]),D(r("span",{title:"取消",class:"common-icon-container",onClick:n=>m(e.uid)},[f(N,{iconName:"cancel","custom-class":"img",width:28})],8,Xt),[[j,(e.status==M(U).uploading.value||e.status==M(U).init.value)&&!e.cancel]])])]))),256))]),Yt])])}}}),he=G(es,[["__scopeId","data-v-11f9e00e"]]);const ts=d=>(ee("data-v-8650a6f3"),d=d(),te(),d),ss={class:"framework"},ns={class:"header"},os=ts(()=>r("div",{class:"logo"},[r("div",{class:"name"},"魔女云盘")],-1)),as={class:"right-panel"},ls={class:"btn-radius"},rs={class:"user-info"},is={class:"avatar"},cs={class:"nickname"},us={class:"body"},ds={class:"left-sider"},ps={class:"body-content"},fs={name:"Layout",components:{FileUploader:he}},hs=Object.assign(fs,{setup(d){const F=ce(),w=pe(),u=k(0),i=k(),c=k(),h=k(),y=k(),b=k(),_=k(!1),p=k(Q.get("userInfo")),x=a=>{const{file:o,filePid:e}=a;_.value=!0,h.value.addFile(o,e)},A=()=>{de(async()=>{var a;(a=b.value)==null||a.reloadTable(),await w.fetchUserSpace()})},R=()=>{i.value.show(p.value)},m=()=>{c.value.show()},z=()=>{delete p.value.avatar,Q.set("userInfo",p.value,0),u.value=new Date().getTime()},l=()=>{ke.confirm("你确定要退出吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",draggable:!0,type:"info"}).then(async()=>{await Ie(),Q.remove("userInfo"),F.push("login")}).catch(()=>{})};return(a,o)=>{const e=V("el-icon"),t=V("el-popover"),n=V("el-dropdown-item"),s=V("el-dropdown-menu"),$=V("el-dropdown"),C=V("router-view");return v(),g("div",ss,[r("div",ns,[os,r("div",as,[f(t,{placement:"bottom",width:"auto","popper-style":"padding:0px;border-radius:8px;",trigger:"click",offset:30,"hide-after":10,visible:_.value,"onUpdate:visible":o[0]||(o[0]=I=>_.value=I)},{reference:S(()=>[r("span",ls,[f(e,{class:"rotate",color:"#454d5a"},{default:S(()=>[f(M(Pe))]),_:1})])]),default:S(()=>[f(he,{ref_key:"uploaderRef",ref:h,onUploadCallback:A},null,512)]),_:1},8,["visible"]),f($,null,{dropdown:S(()=>[f(s,null,{default:S(()=>[f(n,{onClick:R},{default:S(()=>[K("修改头像")]),_:1}),f(n,{onClick:m},{default:S(()=>[K("修改密码")]),_:1}),f(n,{onClick:l},{default:S(()=>[K("退出")]),_:1})]),_:1})]),default:S(()=>[r("div",rs,[r("div",is,[f(Ce,{userId:p.value.id,avatar:p.value.avatar,timestamp:u.value},null,8,["userId","avatar","timestamp"])]),r("span",cs,B(p.value.nickname),1)])]),_:1})])]),r("div",us,[r("div",ds,[f(M(gt),{ref_key:"asideMenuRef",ref:y},null,512)]),r("div",ps,[f(C,null,{default:S(({Component:I})=>[(v(),Z(Ae(I),{ref_key:"routerViewRef",ref:b,onAddFile:x},null,544))]),_:1})])]),f(Ut,{ref_key:"uploadAvatarRef",ref:i,onUploadSuccess:z},null,512),f(Vt,{ref_key:"uploadPasswordRef",ref:c},null,512)])}}}),ms=G(hs,[["__scopeId","data-v-8650a6f3"]]);export{ms as default};
