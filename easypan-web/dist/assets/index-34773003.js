import{Z as x,_ as $,e as n,f as K,h as L,o as i,c as _,a as s,i as c,w as u,p as j,B as q,C as O,j as d,X,k as h,N as m,F as Z,a1 as G,t as I,l as H,I as J,a2 as E,a3 as Q,E as Y,y as ee,z as se,a7 as te,a8 as ae}from"./index-cd067b4e.js";import{B as le}from"./Table-58a1515f.js";import{_ as B}from"./ShareFile.vue_vue_type_style_index_0_scoped_ae51d12c_lang-93d12c37.js";import{D as ie}from"./DeleteFile-ca5d066b.js";const oe=({deleteFile:r,downloadFile:v})=>[{title:"下载",label:"download",icon:"download",showLabel:!0,isShow:o=>!x(o)||x(o)&&o.filter(y=>y.folderType===1).length===0,onClick:o=>{v(o)}},{title:"删除",label:"delete",icon:"delete",showLabel:!0,onClick:o=>{r(o)}}];const N=r=>(ee("data-v-4736d700"),r=r(),se(),r),ne={class:"main"},ce={class:"main-header"},de={class:"actions"},re={class:"search"},pe={class:"file-action"},_e={class:"main-body"},ue={class:"nav"},fe={class:"nav-list"},he={class:"nav-left"},me={class:"file-list"},ve={class:"file-item"},ye={key:2,class:"file-name"},we=["onClick"],ke={class:"file-size"},ge={key:0},be={key:1},Se={class:"table-empty"},xe={class:"main-empty"},Ce={class:"u-empty"},Fe={class:"empty-image"},Te=N(()=>s("div",{class:"empty-description"},[s("span",{class:"text"},"当前列表为空，上传你的第一个文件吧")],-1)),Re=N(()=>s("div",{class:"empty-bottom"},[s("div",{class:"empty-action"})],-1)),ze={name:"Main",components:{Preview:E}},De=Object.assign(ze,{emits:["addFile"],setup(r,{expose:v,emit:o}){const y=[{label:"文件名",prop:"filename",scopedSlots:"filename",ellipsis:!0,minWidth:"40%"},{label:"发布人",prop:"nickname",minWidth:"20%"},{label:"修改时间",prop:"updateTime",minWidth:"20%",scopedSlots:"RowAction"},{label:"大小",prop:"fileSize",scopedSlots:"fileSize",minWidth:"20%"}],{fileUrlMap:C}=ae,F=n(),T=n(),R=n(),z=n(),w=n(),k=n([]),V=n({id:"0"}),g=n(y),b=K({page:1,pageSize:20,filePid:"0"}),D=oe({deleteFile:e=>{z.value.show(e)},downloadFile:async e=>{W(e)}});function f(){var e;(e=F.value)==null||e.reload()}function U(e){const{curFolder:a}=e;b.filePid=a.id,V.value=a,f()}const A=async e=>{const a={...e,...b};try{return Q(a)}catch{return[]}},M=e=>{e.length>0?g.value[0].label=`已选中${e.length}个文件/文件夹`:g.value[0].label="文件名";const a=e.map(l=>(l.id=l.userId+"_"+l.id,l));k.value=a},S=()=>{b.filename=w.value,f()},P=e=>{if(e.folderType==1){T.value.openFolder(e);return}if(e.status!=2){Y.warning("文件未完成转码，无法预览");return}R.value.showPreview(e,1)},W=async e=>{if(x(e))return;const a=C[1].createDownloadUrl+"/"+e.userId+"/"+e.id,l=await te(a);l&&(window.location.href=C[1].downloadUrl+"/"+l.code)};return v({reloadTable:f}),(e,a)=>{const l=L("el-input");return i(),_("div",ne,[s("div",ce,[s("div",de,[s("div",re,[c(l,{modelValue:w.value,"onUpdate:modelValue":a[0]||(a[0]=p=>w.value=p),size:"small",clearable:"",placeholder:"搜索我的文件","input-style":"height: 32px",onKeyup:j(S,["enter"]),onClear:S},{suffix:u(()=>[s("span",{class:"text",onClick:S},"搜索")]),_:1},8,["modelValue","onKeyup"])]),q(s("div",pe,[c(d(B),{value:k.value,actions:d(D)},null,8,["value","actions"])],512),[[O,k.value.length>0]])])]),s("div",_e,[s("div",ue,[s("div",fe,[s("div",he,[c(X,{ref_key:"navigationRef",ref:T,onNavChange:U},null,512)])])]),s("div",me,[c(d(le),{ref_key:"dataTableRef",ref:F,columns:g.value,"row-key":p=>p.id,request:A,loading:!0,onSelectChange:M},{filename:u(({index:p,row:t})=>[s("div",ve,[(t.fileType==3||t.fileType==1)&&t.status==2?(i(),h(m,{key:0,cover:t.fileCover,width:32},null,8,["cover"])):(i(),_(Z,{key:1},[t.folderType==0?(i(),h(m,{key:0,"file-type":t.fileType},null,8,["file-type"])):(i(),h(m,{key:1,"file-type":0}))],64)),t.showEdit?H("",!0):(i(),_("span",ye,[s("span",{class:"text",onClick:G(Ie=>P(t),["stop"])},I(t.filename),9,we)]))])]),RowAction:u(({index:p,row:t})=>[(i(),h(d(B),{mode:"row",value:t,field:"updateTime",key:t.showEdit,actions:d(D)},null,8,["value","actions"]))]),fileSize:u(({index:p,row:t})=>[s("div",ke,[t.fileSize?(i(),_("span",ge,I(d(J)(t.fileSize)),1)):(i(),_("span",be," - "))])]),empty:u(()=>[s("div",Se,[s("div",xe,[s("div",Ce,[s("div",Fe,[c(m,{"icon-name":"empty",width:120,height:"auto"})]),Te,Re])])])]),_:1},8,["columns","row-key"])])]),c(E,{ref_key:"previewRef",ref:R},null,512),c(d(ie),{ref_key:"deleteFileRef",ref:z,onDeleteSuccess:f},null,512)])}}}),Ue=$(De,[["__scopeId","data-v-4736d700"]]);export{Ue as default};
